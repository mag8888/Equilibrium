<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß MLM –û–¢–õ–ê–î–ö–ê</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            padding: 20px;
        }
        
        .debug-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .debug-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            font-family: monospace;
        }
        
        .structure-container {
            position: relative;
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            min-height: 600px;
            overflow: auto;
        }
        
        .node {
            position: absolute;
            background: #fff;
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 10px 15px;
            text-align: center;
            min-width: 150px;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .node.active {
            background: linear-gradient(145deg, #8b5cf6, #7c3aed);
            color: white;
            border-color: #7c3aed;
        }
        
        .node-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .node-level {
            font-size: 12px;
            color: #666;
        }
        
        .node.active .node-level {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .connection-line {
            position: absolute;
            stroke: #3b82f6;
            stroke-width: 2;
            fill: none;
            z-index: 5;
            pointer-events: none;
        }
        
        .stats {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .controls {
            margin-bottom: 10px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 16px;
            margin-right: 10px;
            cursor: pointer;
        }
        
        .btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h2>üîß MLM –°–¢–†–£–ö–¢–£–†–ê - –û–¢–õ–ê–î–ö–ê</h2>
        
        <div class="debug-info" id="debugInfo">
            üîç –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
        </div>
        
        <div class="stats">
            <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong>
            <span id="nodeCount">–£–∑–ª–æ–≤: 0</span> | 
            <span id="connectionCount">–°–≤—è–∑–µ–π: 0</span>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="renderStructure()">üîÑ –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å</button>
            <button class="btn" onclick="clearStructure()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            <button class="btn" onclick="testConnections()">üîó –¢–µ—Å—Ç —Å–≤—è–∑–µ–π</button>
        </div>
    </div>
    
    <div class="structure-container" id="structureContainer">
        <!-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
    </div>

    <script>
        console.log('üöÄ MLM Debug Loading...');
        
        function updateDebugInfo(message) {
            const debugInfo = document.getElementById('debugInfo');
            if (debugInfo) {
                debugInfo.textContent = message;
                console.log('üîç Debug:', message);
            }
        }
        
        // –ü–†–û–°–¢–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –î–õ–Ø –û–¢–õ–ê–î–ö–ò
        const structure = {
            id: 'plazma',
            name: 'PLAZMA',
            level: 4,
            x: 300,
            y: 50,
            children: [
                {
                    id: '3-1',
                    name: '3*/1',
                    level: 3,
                    x: 150,
                    y: 200,
                    children: [
                        {
                            id: '2-1',
                            name: '2*/1',
                            level: 2,
                            x: 100,
                            y: 350,
                            children: [
                                { id: '1-1', name: '1*/1', level: 1, x: 50, y: 500 },
                                { id: '1-2', name: '1*/2', level: 1, x: 150, y: 500 }
                            ]
                        },
                        {
                            id: '2-2',
                            name: '2*/2',
                            level: 2,
                            x: 200,
                            y: 350,
                            children: [
                                { id: '1-3', name: '1*/3', level: 1, x: 150, y: 500 },
                                { id: '1-4', name: '1*/4', level: 1, x: 250, y: 500 }
                            ]
                        }
                    ]
                },
                {
                    id: '3-2',
                    name: '3*/2',
                    level: 3,
                    x: 450,
                    y: 200,
                    children: [
                        {
                            id: '2-3',
                            name: '2*/3',
                            level: 2,
                            x: 400,
                            y: 350,
                            children: [
                                { id: '1-5', name: '1*/5', level: 1, x: 350, y: 500 },
                                { id: '1-6', name: '1*/6', level: 1, x: 450, y: 500 }
                            ]
                        },
                        {
                            id: '2-4',
                            name: '2*/4',
                            level: 2,
                            x: 500,
                            y: 350,
                            children: [
                                { id: '1-7', name: '1*/7', level: 1, x: 450, y: 500 },
                                { id: '1-8', name: '1*/8', level: 1, x: 550, y: 500 }
                            ]
                        }
                    ]
                }
            ]
        };
        
        let nodeCount = 0;
        let connectionCount = 0;
        
        function renderNode(node) {
            console.log('üéØ Rendering node:', node.name, 'at', node.x, node.y);
            updateDebugInfo(`–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —É–∑–ª–∞: ${node.name} –≤ –ø–æ–∑–∏—Ü–∏–∏ (${node.x}, ${node.y})`);
            
            const nodeElement = document.createElement('div');
            nodeElement.className = `node ${node.level === 4 ? 'active' : ''}`;
            nodeElement.id = `node-${node.id}`;
            nodeElement.style.left = `${node.x}px`;
            nodeElement.style.top = `${node.y}px`;
            nodeElement.innerHTML = `
                <div class="node-name">${node.name}</div>
                <div class="node-level">${node.level}*/${node.id.split('-')[1] || '1'}</div>
            `;
            
            const container = document.getElementById('structureContainer');
            if (container) {
                container.appendChild(nodeElement);
                nodeCount++;
                console.log('‚úÖ Node added to container');
            } else {
                console.error('‚ùå Container not found!');
                updateDebugInfo('‚ùå –û—à–∏–±–∫–∞: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!');
            }
        }
        
        function renderConnection(parentId, childId) {
            const parent = findNodeById(structure, parentId);
            const child = findNodeById(structure, childId);
            
            if (!parent || !child) {
                console.log('‚ùå Parent or child not found:', parentId, childId);
                return;
            }
            
            console.log(`üîó Connecting ${parentId} to ${childId}`);
            
            const pX = parent.x + 75; // –¶–µ–Ω—Ç—Ä —É–∑–ª–∞
            const pY = parent.y + 40; // –ù–∏–∑ —É–∑–ª–∞
            const cX = child.x + 75;  // –¶–µ–Ω—Ç—Ä —É–∑–ª–∞
            const cY = child.y;       // –í–µ—Ä—Ö —É–∑–ª–∞
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('stroke', '#3b82f6');
            path.setAttribute('stroke-width', '2');
            path.setAttribute('fill', 'none');
            path.setAttribute('class', 'connection-line');
            path.setAttribute('d', `M ${pX} ${pY} L ${cX} ${cY}`);
            
            let svg = document.getElementById('connection-svg');
            if (!svg) {
                svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('id', 'connection-svg');
                svg.style.position = 'absolute';
                svg.style.top = '0';
                svg.style.left = '0';
                svg.style.width = '100%';
                svg.style.height = '100%';
                svg.style.pointerEvents = 'none';
                svg.style.zIndex = '1';
                document.getElementById('structureContainer').appendChild(svg);
            }
            
            svg.appendChild(path);
            connectionCount++;
            console.log('‚úÖ Connection line added');
        }
        
        function findNodeById(root, id) {
            if (root.id === id) return root;
            if (root.children) {
                for (let child of root.children) {
                    const found = findNodeById(child, id);
                    if (found) return found;
                }
            }
            return null;
        }
        
        function renderStructure() {
            console.log('üé® Rendering structure...');
            updateDebugInfo('–ù–∞—á–∏–Ω–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã...');
            
            const container = document.getElementById('structureContainer');
            if (!container) {
                console.error('‚ùå Container not found!');
                return;
            }
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            container.innerHTML = '';
            nodeCount = 0;
            connectionCount = 0;
            
            // –°–æ–∑–¥–∞–µ–º SVG –¥–ª—è —Å–≤—è–∑–µ–π
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('id', 'connection-svg');
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.pointerEvents = 'none';
            svg.style.zIndex = '1';
            container.appendChild(svg);
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —É–∑–ª—ã —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
            function renderNodeRecursive(node) {
                renderNode(node);
                if (node.children) {
                    node.children.forEach(child => renderNodeRecursive(child));
                }
            }
            
            renderNodeRecursive(structure);
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —Å–≤—è–∑–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
            function renderConnectionsRecursive(node) {
                if (node.children) {
                    node.children.forEach(child => {
                        renderConnection(node.id, child.id);
                        renderConnectionsRecursive(child);
                    });
                }
            }
            
            renderConnectionsRecursive(structure);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('nodeCount').textContent = `–£–∑–ª–æ–≤: ${nodeCount}`;
            document.getElementById('connectionCount').textContent = `–°–≤—è–∑–µ–π: ${connectionCount}`;
            
            updateDebugInfo(`‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞! –£–∑–ª–æ–≤: ${nodeCount}, –°–≤—è–∑–µ–π: ${connectionCount}`);
            console.log('‚úÖ Structure rendered successfully!');
        }
        
        function clearStructure() {
            const container = document.getElementById('structureContainer');
            container.innerHTML = '';
            nodeCount = 0;
            connectionCount = 0;
            document.getElementById('nodeCount').textContent = '–£–∑–ª–æ–≤: 0';
            document.getElementById('connectionCount').textContent = '–°–≤—è–∑–µ–π: 0';
            updateDebugInfo('üóëÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—á–∏—â–µ–Ω–∞');
        }
        
        function testConnections() {
            updateDebugInfo('üîó –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–≤—è–∑–∏...');
            console.log('üîó Testing connections...');
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫ —É–∑–ª–æ–≤
            const plazma = findNodeById(structure, 'plazma');
            const node3_1 = findNodeById(structure, '3-1');
            const node2_1 = findNodeById(structure, '2-1');
            const node1_1 = findNodeById(structure, '1-1');
            
            console.log('PLAZMA found:', plazma);
            console.log('3-1 found:', node3_1);
            console.log('2-1 found:', node2_1);
            console.log('1-1 found:', node1_1);
            
            updateDebugInfo(`üîó –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω. PLAZMA: ${plazma ? '‚úÖ' : '‚ùå'}, 3-1: ${node3_1 ? '‚úÖ' : '‚ùå'}, 2-1: ${node2_1 ? '‚úÖ' : '‚ùå'}, 1-1: ${node1_1 ? '‚úÖ' : '‚ùå'}`);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM Content Loaded');
            updateDebugInfo('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...');
            renderStructure();
        });
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        setTimeout(function() {
            console.log('‚è∞ Delayed initialization');
            updateDebugInfo('–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
            renderStructure();
        }, 100);
    </script>
</body>
</html>
