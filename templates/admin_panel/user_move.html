{% extends 'base/base.html' %}

{% block title %}Перемещение пользователя{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1"><i class="fas fa-arrows-alt text-primary me-2"></i>Переместить {{ user.username }}</h1>
        <p class="text-muted mb-0">Выберите нового наставника для участника. Потомки переедут вместе с ним.</p>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'admin_panel:user_structure' user.id %}" class="btn btn-outline-secondary">
            <i class="fas fa-sitemap me-2"></i>Текущая структура
        </a>
        <a href="{% url 'admin_panel:users_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-users me-2"></i>Список
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body p-4">
        <form method="post" class="row g-4">
            {% csrf_token %}
            <div class="col-12">
                <label class="form-label fw-semibold">Новый родитель (наставник)</label>
                <select class="form-select" name="parent_id">
                    <option value="">Сделать корневым (без наставника)</option>
                    {% for parent in available_parents %}
                        <option value="{{ parent.id }}" {% if current_parent and current_parent.id == parent.id %}selected{% endif %}>
                            {{ parent.username }} — {{ parent.get_status_display }} ({{ parent.referrals.count }} в 1-й линии)
                        </option>
                    {% endfor %}
                </select>
                <div class="form-text">Недоступны текущий пользователь и его структура, чтобы избежать циклов.</div>
            </div>
            <div class="col-12 d-flex justify-content-end">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-check me-2"></i>Переместить
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
