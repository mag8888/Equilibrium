<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>üëë –ü–†–û–§–ò–õ–¨ –ü–ê–†–¢–ù–ï–†–ê IVA v56 - –ü–†–û–í–ï–†–ö–ê –í–°–ï–• –ü–ê–†–¢–ù–ï–†–û–í</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: white;
            color: #333;
            overflow-x: auto;
            overflow-y: auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            color: #333;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #666;
        }
        
        .status {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .status-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #059669;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            margin: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }
        
        .structure-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            min-height: 80vh;
            overflow: auto;
            position: relative;
            width: 100%;
            max-width: none;
        }
        
        .mindmap-container {
            position: relative;
            width: 100%;
            height: 4550px; /* –£–≤–µ–ª–∏—á–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞ –Ω–∞ 30%: 3500 + 1050 = 4550px */
            margin: 0 auto;
            min-width: 2500px; /* –£–≤–µ–ª–∏—á–µ–Ω–∞ —à–∏—Ä–∏–Ω–∞ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π */
            padding: 400px 100px; /* –£–≤–µ–ª–∏—á–µ–Ω padding –¥–ª—è –µ—â–µ –±–æ–ª—å—à–µ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ */
        }
        
        .user-card {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px 16px;
            text-align: center;
            cursor: move;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-width: 120px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            z-index: 10;
            user-select: none;
        }
        
        /* –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π 0*-7* */
        .user-card[data-level="0"] {
            background: linear-gradient(135deg, #FFFFFF, #F5F5F5); /* –ë–µ–ª—ã–π - Level 0* */
            border: 2px solid #E0E0E0;
            color: #333;
        }
        
        .user-card[data-level="1"] {
            background: linear-gradient(135deg, #E3F2FD, #BBDEFB); /* –ì–æ–ª—É–±–æ–π - Level 1* */
            border: 2px solid #90CAF9;
            color: #1565C0;
        }
        
        .user-card[data-level="2"] {
            background: linear-gradient(135deg, #C8E6C9, #A5D6A7); /* –ó–µ–ª–µ–Ω—ã–π - Level 2* */
            border: 2px solid #81C784;
            color: #2E7D32;
        }
        
        .user-card[data-level="3"] {
            background: linear-gradient(135deg, #FFF9C4, #FFF59D); /* –ñ–µ–ª—Ç—ã–π - Level 3* */
            border: 2px solid #FFD54F;
            color: #F57F17;
        }
        
        .user-card[data-level="4"] {
            background: linear-gradient(135deg, #FFCCBC, #FFAB91); /* –û—Ä–∞–Ω–∂–µ–≤—ã–π - Level 4* */
            border: 2px solid #FF8A65;
            color: #D84315;
        }
        
        .user-card[data-level="5"] {
            background: linear-gradient(135deg, #F8BBD0, #F48FB1); /* –†–æ–∑–æ–≤—ã–π - Level 5* */
            border: 2px solid #F06292;
            color: #C2185B;
        }
        
        .user-card[data-level="6"] {
            background: linear-gradient(135deg, #E1BEE7, #CE93D8); /* –°–∏—Ä–µ–Ω–µ–≤—ã–π - Level 6* */
            border: 2px solid #BA68C8;
            color: #7B1FA2;
        }
        
        .user-card[data-level="7"] {
            background: linear-gradient(135deg, #B39DDB, #9C27B0); /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π - Level 7* */
            border: 2px solid #7B1FA2;
            color: white;
        }
        
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è IVA —Å —É—á–µ—Ç–æ–º —É—Ä–æ–≤–Ω—è */
        .user-card[data-is-iva="true"][data-level="0"] {
            background: linear-gradient(135deg, #FFFFFF, #F5F5F5) !important; /* –ë–µ–ª—ã–π - Level 0* */
            border: 3px solid #10B981 !important; /* –ó–µ–ª–µ–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è IVA */
            color: #10B981 !important;
        }
        
        .user-card[data-is-iva="true"][data-level="1"] {
            background: linear-gradient(135deg, #E3F2FD, #BBDEFB) !important; /* –ì–æ–ª—É–±–æ–π - Level 1* */
            border: 3px solid #059669 !important;
            color: #1565C0 !important;
        }
        
        .user-card[data-is-iva="true"][data-level="2"] {
            background: linear-gradient(135deg, #C8E6C9, #A5D6A7) !important; /* –ó–µ–ª–µ–Ω—ã–π - Level 2* */
            border: 3px solid #059669 !important;
            color: #2E7D32 !important;
        }
        
        .user-card[data-is-iva="true"][data-level="3"] {
            background: linear-gradient(135deg, #FFF9C4, #FFF59D) !important; /* –ñ–µ–ª—Ç—ã–π - Level 3* */
            border: 3px solid #059669 !important;
            color: #F57F17 !important;
        }
        
        .user-card[data-is-iva="true"][data-level="4"] {
            background: linear-gradient(135deg, #FFCCBC, #FFAB91) !important; /* –û—Ä–∞–Ω–∂–µ–≤—ã–π - Level 4* */
            border: 3px solid #059669 !important;
            color: #D84315 !important;
        }
        
        .user-card[data-is-iva="true"][data-level="5"] {
            background: linear-gradient(135deg, #F8BBD0, #F48FB1) !important; /* –†–æ–∑–æ–≤—ã–π - Level 5* */
            border: 3px solid #059669 !important;
            color: #C2185B !important;
        }
        
        .user-card[data-is-iva="true"][data-level="6"] {
            background: linear-gradient(135deg, #E1BEE7, #CE93D8) !important; /* –°–∏—Ä–µ–Ω–µ–≤—ã–π - Level 6* */
            border: 3px solid #059669 !important;
            color: #7B1FA2 !important;
        }
        
        .user-card[data-is-iva="true"][data-level="7"] {
            background: linear-gradient(135deg, #B39DDB, #9C27B0) !important; /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π - Level 7* */
            border: 3px solid #059669 !important;
            color: white !important;
        }
        
        .user-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        .user-card.dragging {
            z-index: 1000;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            cursor: grabbing;
            transition: none;
        }
        
        .user-card.collision {
            border-color: #EF4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
        }
        
        .user-card.root {
            background: linear-gradient(135deg, #8B5CF6, #A855F7);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .user-card.root:hover {
            transform: scale(1.15);
        }
        
        .connection-point {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #3B82F6;
            border: 2px solid white;
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            z-index: 15;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .connection-point.left {
            left: -6px;
        }
        
        .connection-point.right {
            right: -6px;
            background: #10B981;
        }
        
        .connection-point.right:hover {
            background: #059669;
            transform: translateY(-50%) scale(1.3);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.6);
        }
        
        .connection-point.right:active {
            transform: translateY(-50%) scale(0.9);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —É–∑–ª–æ–≤ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            50% {
                transform: scale(1.15);
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.6);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
        }
        
        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 3px;
            line-height: 1.2;
        }
        
        .user-id {
            font-size: 0.75rem;
            opacity: 0.8;
            font-weight: 500;
        }
        
        .expand-circle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #3B82F6;
            border-radius: 50%;
            top: 50%;
            right: -6px;
            transform: translateY(-50%);
            cursor: pointer;
            z-index: 15;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .expand-circle::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .connection-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        .stats-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .stats-title {
            font-size: 1.8rem;
            color: #667eea;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 1.1rem;
            color: #666;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .title { font-size: 2rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .user-card { min-width: 100px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">üåê MLM –°–¢–†–£–ö–¢–£–†–ê - –°–ö–†–û–õ–õ–ò–ù–ì –ü–û–î–õ–û–ñ–ö–ò v108 - –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–ï –í –õ–Æ–ë–£–Æ –°–¢–û–†–û–ù–£</div>
        <div class="subtitle">–°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —É–∑–ª–æ–≤ –≤–≤–µ—Ä—Ö –∏ –≤–Ω–∏–∑ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –±–µ–∑ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π</div>
    </div>
    
    <div class="status">
        <div class="status-text">‚úÖ –°—Ç–∞—Ç—É—Å: –°–ò–ú–ú–ï–¢–†–ò–ß–ù–ê–Ø –ú–ê–ô–ù–î-–ö–ê–†–¢–ê v32! –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è - —É–∑–ª—ã —Ö–æ—Ä–æ—à–æ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã</div>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="renderMindMap()">üîÑ –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å</button>
        <button class="btn" onclick="clearMindMap()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        <button class="btn" onclick="addLevel0()">‚ûï –î–æ–±–∞–≤–∏—Ç—å 0-–π —É—Ä–æ–≤–µ–Ω—å</button>
        <button class="btn" onclick="generateIndividualStructures()">üèóÔ∏è MLM —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ 1‚Üí3‚Üí9‚Üí27‚Üí81</button>
        <button class="btn" onclick="fixOverlaps()">üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è</button>
        <button class="btn" onclick="checkOverlaps()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è</button>
        <button class="btn" onclick="rebuildConnections()">üîó –ü–µ—Ä–µ—Å—Ç—Ä–æ–∏—Ç—å —Å–≤—è–∑–∏</button>
        <button class="btn" onclick="checkAndRedrawConnections()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–≤—è–∑–∏</button>
        <button class="btn" onclick="testConnections()">üîó –¢–µ—Å—Ç —Å–≤—è–∑–µ–π</button>
        <button class="btn" onclick="generateIndividualStructures()">üåê –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞</button>
        <button class="btn" onclick="centerView()">üéØ –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="btn" onclick="openBotChat()">üí¨ –ü–∏—Å–∞—Ç—å —á–µ—Ä–µ–∑ –±–æ—Ç</button>
        <button class="btn" onclick="alert('–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–µ–ª–µ–Ω—É—é —Ç–æ—á–∫—É —Å–ø—Ä–∞–≤–∞ –æ—Ç –ª—é–±–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ—á–µ—Ä–Ω–µ–≥–æ —É–∑–ª–∞!')">‚ÑπÔ∏è –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª</button>
        <button class="btn" onclick="addGreenPointsToAll()" style="background: linear-gradient(135deg, #10B981, #059669); color: white; font-weight: bold;">üü¢ –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤–∏—Ç—å –∑–µ–ª–µ–Ω—ã–µ —Ç–æ—á–∫–∏ –í–ï–ó–î–ï</button>
        <button class="btn" onclick="recreateStructureWithNewSpacing()" style="background: linear-gradient(135deg, #F59E0B, #D97706); color: white; font-weight: bold;">üìè –ü–ï–†–ï–°–û–ó–î–ê–¢–¨ —Å –Ω–æ–≤—ã–º–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è–º–∏</button>
        <button class="btn" onclick="enableDragForAllCards()" style="background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; font-weight: bold;">üñ±Ô∏è –í–ö–õ–Æ–ß–ò–¢–¨ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö</button>
        <button class="btn" onclick="enableBackgroundPanning()" style="background: linear-gradient(135deg, #06B6D4, #0891B2); color: white; font-weight: bold;">üñ±Ô∏è –í–ö–õ–Æ–ß–ò–¢–¨ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ —Ñ–æ–Ω—É</button>
        <button class="btn" onclick="clearPartnerStructure()" style="background: linear-gradient(135deg, #EF4444, #DC2626); color: white; font-weight: bold;">üóëÔ∏è –û–ß–ò–°–¢–ò–¢–¨ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</button>
        <button class="btn" onclick="showPartnerInstructions()" style="background: linear-gradient(135deg, #10B981, #059669); color: white; font-weight: bold;">‚ÑπÔ∏è –ö–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</button>
        <button class="btn" onclick="resetToIVAOnly()" style="background: linear-gradient(135deg, #F59E0B, #D97706); color: white; font-weight: bold;">üëë –°–ë–†–û–° –∫ IVA</button>
        <button class="btn" onclick="clearAllPartners()" style="background: linear-gradient(135deg, #EF4444, #DC2626); color: white; font-weight: bold;">üóëÔ∏è –û–ß–ò–°–¢–ò–¢–¨ –ü–ê–†–¢–ù–ï–†–û–í</button>
        <button class="btn" onclick="showIVAProgression()" style="background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; font-weight: bold;">üìà –ü–†–û–ì–†–ï–°–°–ò–Ø IVA</button>
        <button class="btn" onclick="autoLayout111();" style="background: linear-gradient(135deg, #3B82F6, #2563EB); color: white; font-weight: bold;">—Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ 111</button>
        <button class="btn" onclick="autoLayoutNoOverlap(); rebuildConnections(); resolveCollisions();" style="background: linear-gradient(135deg, #10B981, #059669); color: white; font-weight: bold;">üé® –ö–†–ê–°–ò–í–ê–Ø –†–ê–°–ö–õ–ê–î–ö–ê</button>
        <button class="btn" onclick="recalculatePositionsOnChange();" style="background: linear-gradient(135deg, #F59E0B, #D97706); color: white; font-weight: bold;">üéØ –ü–ï–†–ï–°–ß–ï–¢ –ü–û–ó–ò–¶–ò–ô</button>
        <button class="btn" onclick="autoLayoutNoOverlap(); rebuildConnections();" style="background: linear-gradient(135deg, #EF4444, #DC2626); color: white; font-weight: bold;">üö´ –ò–°–ü–†–ê–í–ò–¢–¨ –ù–ê–õ–û–ñ–ï–ù–ò–Ø</button>
        <button class="btn" onclick="enableBackgroundScrolling();" style="background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; font-weight: bold;">üñ±Ô∏è –í–ö–õ–Æ–ß–ò–¢–¨ –°–ö–†–û–õ–õ–ò–ù–ì</button>
        <button class="btn" onclick="disableBackgroundScrolling();" style="background: linear-gradient(135deg, #6B7280, #4B5563); color: white; font-weight: bold;">üö´ –û–¢–ö–õ–Æ–ß–ò–¢–¨ –°–ö–†–û–õ–õ–ò–ù–ì</button>
    </div>
    
    <div class="structure-container">
        <div class="mindmap-container" id="mindmapContainer">
            <!-- SVG –¥–ª—è –∏–∑–æ–≥–Ω—É—Ç—ã—Ö –ª–∏–Ω–∏–π -->
            <svg class="connection-svg" id="connectionSvg"></svg>
        </div>
    </div>
    
    <div class="stats-panel">
        <div class="stats-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞–π–Ω–¥-–∫–∞—Ä—Ç—ã</div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number" id="totalNodes">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ —É–∑–ª–æ–≤</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="totalConnections">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ —Å–≤—è–∑–µ–π</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="level0Count">0</div>
                <div class="stat-label">–£—á–∞—Å—Ç–Ω–∏–∫–∏ (0-–π)</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="level1Count">0</div>
                <div class="stat-label">–ü–∞—Ä—Ç–Ω–µ—Ä—ã (1-–π)</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="level2Count">0</div>
                <div class="stat-label">–ü–∞—Ä—Ç–Ω–µ—Ä—ã (2-–π)</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="level3Count">0</div>
                <div class="stat-label">–ü–∞—Ä—Ç–Ω–µ—Ä—ã (3-–π)</div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 20px; font-size: 1.2rem; font-weight: 600; color: #059669;">
            <span id="statusMessage">‚úÖ –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–ê–Ø –ú–ê–ô–ù–î-–ö–ê–†–¢–ê –≥–æ—Ç–æ–≤–∞!</span>
        </div>
    </div>
    
    <script>
        console.log('üåê MLM Mind Map Loading - VERSION v108 - –°–ö–†–û–õ–õ–ò–ù–ì –ü–û–î–õ–û–ñ–ö–ò!');
        
        // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –∏–º–µ–Ω –¥–ª—è –Ω–∏–∂–Ω–µ–π —Å—Ç—Ä–æ–∫–∏
        function generateHumanName() {
            const names = [
                '–ò–≤–∞–Ω', '–†–æ–º–∞–Ω', '–ï–ª–µ–Ω–∞', '–ê–Ω–Ω–∞', '–ú–∞—Ä–∏—è', '–û–ª—å–≥–∞', '–ù–∞—Ç–∞–ª—å—è', '–°–æ—Ñ–∏—è', '–ü–æ–ª–∏–Ω–∞', '–ö—Å–µ–Ω–∏—è',
                '–î–º–∏—Ç—Ä–∏–π', '–ê–ª–µ–∫—Å–µ–π', '–°–µ—Ä–≥–µ–π', '–ü–∞–≤–µ–ª', '–ê–Ω–¥—Ä–µ–π', '–í–∏–∫—Ç–æ—Ä', '–†—É—Å–ª–∞–Ω', '–ï–≤–≥–µ–Ω–∏–π', '–ú–∞–∫—Å–∏–º', '–ò–≥–æ—Ä—å',
                '–¢–∞—Ç—å—è–Ω–∞', '–ê–ª–∏–Ω–∞', '–Æ–ª–∏—è', '–í–∞–ª–µ—Ä–∏—è', '–ö–∞—Ç–µ—Ä–∏–Ω–∞', '–í–µ—Ä–æ–Ω–∏–∫–∞', '–õ–∏–ª–∏—è', '–û–∫—Å–∞–Ω–∞', '–ê–ª—ë–Ω–∞', '–ò—Ä–∏–Ω–∞'
            ];
            const surname = ['–ò–≤–∞–Ω–æ–≤', '–ü–µ—Ç—Ä–æ–≤', '–°–∏–¥–æ—Ä–æ–≤', '–ö—É–∑–Ω–µ—Ü–æ–≤', '–°–º–∏—Ä–Ω–æ–≤', '–í–∞—Å–∏–ª—å–µ–≤', '–ú–æ—Ä–æ–∑–æ–≤', '–ï–≥–æ—Ä–æ–≤', '–û—Ä–ª–æ–≤', '–ì—Ä–æ–º–æ–≤'];
            const n = names[Math.floor(Math.random() * names.length)];
            const s = surname[Math.floor(Math.random() * surname.length)];
            return `${n} ${s}`;
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ 7-–∑–Ω–∞—á–Ω–æ–≥–æ ID
        function generateUniqueId() {
            return Math.floor(1000000 + Math.random() * 9000000).toString();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –≤ –ë–î
        async function savePartnerToDB(partnerData) {
            try {
                const response = await fetch('/api/mlm/create_partner/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify(partnerData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('üíæ –ü–∞—Ä—Ç–Ω–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î:', result);
                    return result;
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞:', response.statusText);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞:', error);
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF cookie (–Ω—É–∂–Ω–∞ –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤)
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏–∑ –ë–î
        async function loadPartnersFromDB() {
            try {
                const response = await fetch('/api/mlm/partners/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                });
                
                if (response.ok) {
                    const partners = await response.json();
                    console.log('üì• –ó–∞–≥—Ä—É–∂–µ–Ω—ã –ø–∞—Ä—Ç–Ω–µ—Ä—ã –∏–∑ –ë–î:', partners);
                    return partners;
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤:', response.statusText);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤:', error);
            }
            return [];
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –≤ –ë–î
        async function clearPartnersFromDB() {
            try {
                const response = await fetch('/api/mlm/clear_partners/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('üóëÔ∏è –ü–∞—Ä—Ç–Ω–µ—Ä—ã –æ—á–∏—â–µ–Ω—ã –∏–∑ –ë–î:', result);
                    return result;
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤:', response.statusText);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤:', error);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ (–∏–∑ –ë–î –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
        async function clearAllPartners() {
            if (!confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï–• –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                return;
            }
            
            console.log('üóëÔ∏è –û—á–∏—â–∞–µ–º –≤—Å–µ—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤...');
            
            // –û—á–∏—â–∞–µ–º –∏–∑ –ë–î
            const result = await clearPartnersFromDB();
            console.log('üóëÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—á–∏—Å—Ç–∫–∏ –ë–î:', result);
            
            // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            const container = document.getElementById('mindmapContainer');
            container.innerHTML = '';
            
            // –û—á–∏—â–∞–µ–º localStorage
            localStorage.removeItem('mlm_partner_structure');
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é IVA
            setTimeout(() => {
                addIVAPartner();
                console.log('‚úÖ –í—Å–µ –ø–∞—Ä—Ç–Ω–µ—Ä—ã –æ—á–∏—â–µ–Ω—ã, —Å–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è IVA');
            }, 100);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏–∑ –ë–î –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Ö –Ω–∞ –∫–∞—Ä—Ç–µ
        async function loadAndDisplayPartners() {
            console.log('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏–∑ –ë–î...');
            const partners = await loadPartnersFromDB();
            
            if (partners.length === 0) {
                console.log('üì≠ –ü–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –≤ –ë–î –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º IVA');
                addIVAPartner();
                return;
            }
            
            console.log(`üìä –ù–∞–π–¥–µ–Ω–æ ${partners.length} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –≤ –ë–î`);
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º SVG —Å–ª–æ–π –¥–ª—è —Å–≤—è–∑–µ–π)
            const container = document.getElementById('mindmapContainer');
            container.innerHTML = '';
            const svgLayer = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svgLayer.setAttribute('class', 'connection-svg');
            svgLayer.setAttribute('id', 'connectionSvg');
            container.appendChild(svgLayer);
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
            partners.forEach(partner => {
                const card = createNode(
                    partner.unique_id,
                    `${partner.level}*/${partner.id}`,
                    partner.level,
                    { x: partner.position_x, y: partner.position_y },
                    { humanName: partner.human_name, uniqueId: partner.unique_id }
                );
                
                if (partner.parent_uid) {
                    card.setAttribute('data-parent', partner.parent_uid);
                }
                
                container.appendChild(card);
            });
            
            // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–≤—è–∑–∏
            setTimeout(() => {
                autoLayoutNoOverlap();
                rebuildConnections();
                addGreenPointsToAll();
                resolveCollisions();
                console.log('‚úÖ –ü–∞—Ä—Ç–Ω–µ—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã (–∞–≤—Ç–æ-—Ä–∞—Å–∫–ª–∞–¥–∫–∞ –±–µ–∑ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π)');
            }, 100);
        }
        
        const CARD_WIDTH = 150;
        const CARD_HEIGHT = 70;
        const COLUMN_GAP = 170;
        const ROW_GAP = 35;
        const BASE_LEFT = 150;
        const BASE_TOP = 80;
        
        let mindMapNodes = [];
        let mindMapConnections = [];
        let connectionPairs = [];
        let currentLayout = null;
        
        // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –º–∞–π–Ω–¥-–∫–∞—Ä—Ç—ã –°–ò–ú–ú–ï–¢–†–ò–ß–ù–û –í–í–ï–†–• –ò –í–ù–ò–ó
        const mindMapStructure = {
            id: 'plazma',
            name: 'PLAZMA',
            level: 4,
            x: 200,
            y: 600, // –¶–µ–Ω—Ç—Ä –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
            children: [
                {
                    id: '3-1',
                    name: '3*/1',
                    level: 3,
                    x: 500,
                    y: 200, // –í–µ—Ä—Ö–Ω—è—è –≤–µ—Ç–∫–∞
                    children: [
                        {
                            id: '2-1',
                            name: '2*/1',
                            level: 2,
                            x: 800,
                            y: 100,
                            children: [
                                { id: '1-1', name: '1*/1', level: 1, x: 1100, y: 50, children: [] },
                                { id: '1-2', name: '1*/2', level: 1, x: 1100, y: 100, children: [] },
                                { id: '1-3', name: '1*/3', level: 1, x: 1100, y: 150, children: [] }
                            ]
                        },
                        {
                            id: '2-2',
                            name: '2*/2',
                            level: 2,
                            x: 800,
                            y: 200,
                            children: [
                                { id: '1-4', name: '1*/4', level: 1, x: 1100, y: 150, children: [] },
                                { id: '1-5', name: '1*/5', level: 1, x: 1100, y: 200, children: [] },
                                { id: '1-6', name: '1*/6', level: 1, x: 1100, y: 250, children: [] }
                            ]
                        },
                        {
                            id: '2-3',
                            name: '2*/3',
                            level: 2,
                            x: 800,
                            y: 300,
                            children: [
                                { id: '1-7', name: '1*/7', level: 1, x: 1100, y: 250, children: [] },
                                { id: '1-8', name: '1*/8', level: 1, x: 1100, y: 300, children: [] },
                                { id: '1-9', name: '1*/9', level: 1, x: 1100, y: 350, children: [] }
                            ]
                        }
                    ]
                },
                {
                    id: '3-2',
                    name: '3*/2',
                    level: 3,
                    x: 500,
                    y: 600, // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞
                    children: [
                        {
                            id: '2-4',
                            name: '2*/4',
                            level: 2,
                            x: 800,
                            y: 500,
                            children: [
                                { id: '1-10', name: '1*/10', level: 1, x: 1100, y: 450, children: [] },
                                { id: '1-11', name: '1*/11', level: 1, x: 1100, y: 500, children: [] },
                                { id: '1-12', name: '1*/12', level: 1, x: 1100, y: 550, children: [] }
                            ]
                        },
                        {
                            id: '2-5',
                            name: '2*/5',
                            level: 2,
                            x: 800,
                            y: 600,
                            children: [
                                { id: '1-13', name: '1*/13', level: 1, x: 1100, y: 550, children: [] },
                                { id: '1-14', name: '1*/14', level: 1, x: 1100, y: 600, children: [] },
                                { id: '1-15', name: '1*/15', level: 1, x: 1100, y: 650, children: [] }
                            ]
                        },
                        {
                            id: '2-6',
                            name: '2*/6',
                            level: 2,
                            x: 800,
                            y: 700,
                            children: [
                                { id: '1-16', name: '1*/16', level: 1, x: 1100, y: 650, children: [] },
                                { id: '1-17', name: '1*/17', level: 1, x: 1100, y: 700, children: [] },
                                { id: '1-18', name: '1*/18', level: 1, x: 1100, y: 750, children: [] }
                            ]
                        }
                    ]
                },
                {
                    id: '3-3',
                    name: '3*/3',
                    level: 3,
                    x: 500,
                    y: 1000, // –ù–∏–∂–Ω—è—è –≤–µ—Ç–∫–∞
                    children: [
                        {
                            id: '2-7',
                            name: '2*/7',
                            level: 2,
                            x: 800,
                            y: 900,
                            children: [
                                { id: '1-19', name: '1*/19', level: 1, x: 1100, y: 850, children: [] },
                                { id: '1-20', name: '1*/20', level: 1, x: 1100, y: 900, children: [] },
                                { id: '1-21', name: '1*/21', level: 1, x: 1100, y: 950, children: [] }
                            ]
                        },
                        {
                            id: '2-8',
                            name: '2*/8',
                            level: 2,
                            x: 800,
                            y: 1000,
                            children: [
                                { id: '1-22', name: '1*/22', level: 1, x: 1100, y: 950, children: [] },
                                { id: '1-23', name: '1*/23', level: 1, x: 1100, y: 1000, children: [] },
                                { id: '1-24', name: '1*/24', level: 1, x: 1100, y: 1050, children: [] }
                            ]
                        },
                        {
                            id: '2-9',
                            name: '2*/9',
                            level: 2,
                            x: 800,
                            y: 1100,
                            children: [
                                { id: '1-25', name: '1*/25', level: 1, x: 1100, y: 1050, children: [] },
                                { id: '1-26', name: '1*/26', level: 1, x: 1100, y: 1100, children: [] },
                                { id: '1-27', name: '1*/27', level: 1, x: 1100, y: 1150, children: [] }
                            ]
                        }
                    ]
                }
            ]
        };
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –ø—Ä—è–º—ã–µ –¥–µ—Ç–∏ —É–∑–ª–∞
        function getDirectChildren(container, parentId) {
            return Array.from(container.querySelectorAll(`.user-card[data-parent="${parentId}"]`));
        }

        // –ü–æ–∏—Å–∫ –ø–æ –≤–µ—Ç–∫–µ: –Ω–∞–π—Ç–∏ —É–∑–µ–ª –Ω—É–∂–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è —Å <3 –¥–µ—Ç—å–º–∏ –≤ —Å–≤–æ–µ–π –≤–µ—Ç–∫–µ
        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤—ã–±–æ—Ä–∞:
        // 1) –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —É–∑–ª–∞ (–±–ª–∏–∂–µ –∫ –æ—Å–Ω–æ–≤–µ)
        // 2) –º–µ–Ω—å—à–µ –¥–µ—Ç–µ–π (–±—ã—Å—Ç—Ä–µ–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ç—Ä–æ–π–∫–∏)
        // 3) —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ (–º–µ–Ω—å—à–∏–π Y)
        // 4) —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ (–º–µ–Ω—å—à–∏–π X)
        function findBestPlacementInBranch(startNode, targetLevel) {
            const container = document.getElementById('mindmapContainer');
            const queue = [{ node: startNode, depth: 0 }];
            let best = { node: null, depth: Infinity, count: Infinity, y: Infinity, x: Infinity };
            while (queue.length > 0) {
                const { node, depth } = queue.shift();
                const level = parseInt(node.getAttribute('data-level')) || 0;
                const children = getDirectChildren(container, node.id);
                // –ö–∞–Ω–¥–∏–¥–∞—Ç—ã —Ç–æ–ª—å–∫–æ —Ü–µ–ª–µ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
                if (level === targetLevel) {
                    const count = children.length;
                    const nodeY = parseInt(node.style.top) || 0;
                    const nodeX = parseInt(node.style.left) || 0;
                    if (count < 3) {
                        if (
                            depth < best.depth ||
                            (depth === best.depth && (count < best.count ||
                                (count === best.count && (nodeY < best.y || (nodeY === best.y && nodeX < best.x)))))
                        ) {
                            best = { node, depth, count, y: nodeY, x: nodeX };
                        }
                    }
                }
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–∏—Å–∫ –≤–Ω–∏–∑ –ø–æ –≤–µ—Ç–∫–µ
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ–±—Ö–æ–¥–∞: —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑, —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ
                children.sort((a, b) => {
                    const ay = parseInt(a.style.top)||0;
                    const by = parseInt(b.style.top)||0;
                    if (ay !== by) return ay - by;
                    const ax = parseInt(a.style.left)||0;
                    const bx = parseInt(b.style.left)||0;
                    return ax - bx;
                });
                children.forEach(ch => queue.push({ node: ch, depth: depth + 1 }));
            }
            return best.node;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —É–∑–ª–∞
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ —Å —É–º–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
        function addPartnerToCard(parentCard) {
            console.log(`üë• –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ: ${parentCard.id}`);
            
            const parentLevel = parseInt(parentCard.getAttribute('data-level'));
            // –ù–æ–≤—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä—ã –í–°–ï–ì–î–ê —Å–æ–∑–¥–∞—é—Ç—Å—è —É—Ä–æ–≤–Ω–µ–º 0*
            const childLevel = 0;
            
            console.log(`üéØ –†–æ–¥–∏—Ç–µ–ª—å: Level ${parentLevel}, —Å–æ–∑–¥–∞–µ–º –¥–æ—á–µ—Ä–Ω–∏–π: Level ${childLevel}`);
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø—Ä—è–º—ã—Ö –¥–µ—Ç–µ–π —ç—Ç–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è
            const container = document.getElementById('mindmapContainer');
            const directChildren = Array.from(container.querySelectorAll(`.user-card[data-parent="${parentCard.id}"]`));
            
            console.log(`üë∂ –£ —Ä–æ–¥–∏—Ç–µ–ª—è ${parentCard.id} —É–∂–µ –µ—Å—Ç—å ${directChildren.length} –ø—Ä—è–º—ã—Ö –¥–µ—Ç–µ–π`);
            
            let targetParent = parentCard;
            let targetLevel = childLevel;
            
            // –ù–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ: 0* –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π —É–∑–µ–ª —É—Ä–æ–≤–Ω—è 0 —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º —Å–ª–æ—Ç–æ–º (<3)
            // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —Ä–æ–¥–∏—Ç–µ–ª—å –Ω–µ 0 –ò–õ–ò —É –Ω–µ–≥–æ —É–∂–µ 3 –¥–µ—Ç–µ–π ‚Äî –∏—â–µ–º –±–ª–∏–∂–∞–π—à–∏–π 0*
            if (parentLevel !== 0 || directChildren.length >= 3) {
                console.log('üîÑ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –∏—â–µ–º –±–ª–∏–∂–∞–π—à–∏–π 0* –ø–æ –≤–µ—Ç–∫–µ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ 0*...');
                const bestZero = findBestPlacementInBranch(parentCard, 0);
                if (bestZero) {
                    targetParent = bestZero;
                    targetLevel = 0;
                    console.log(`‚úÖ –ù–∞–π–¥–µ–Ω –±–ª–∏–∂–∞–π—à–∏–π 0*: ${bestZero.id}`);
                }
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
            const uniqueId = generateUniqueId();
            let existingChildren = container.querySelectorAll(`.user-card[data-parent="${targetParent.id}"]`);
            if (existingChildren.length >= 3) {
                console.log('‚ùå –£ —Ü–µ–ª–µ–≤–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è —É–∂–µ 3 —Ä–µ–±–µ–Ω–∫–∞ ‚Äì –∏—â–µ–º –¥—Ä—É–≥–æ–π —É–∑–µ–ª —É—Ä–æ–≤–Ω—è 0*');
                const altNode = findBestPlacementInBranch(targetParent, 0) || findBestPlacementInBranch(parentCard, 0);
                if (altNode) {
                    targetParent = altNode;
                    existingChildren = container.querySelectorAll(`.user-card[data-parent="${targetParent.id}"]`);
                }
            }
            const childNumber = existingChildren.length + 1;
            
            const newChildId = `partner-${targetLevel}-${uniqueId}`;
            const newChildName = `${targetLevel}*/${childNumber}`;
            const humanName = generateHumanName();
            
            // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
            const parentRect = targetParent.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const parentX = parentRect.left - containerRect.left;
            const parentY = parentRect.top - containerRect.top;
            
            // –†–∞–∑–º–µ—â–∞–µ–º –¥–µ—Ç–µ–π —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º
            const childX = parentX + 200; // –°–º–µ—â–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ
            let childY;
            
            if (childNumber === 1) {
                childY = parentY - 120; // –ü–µ—Ä–≤—ã–π —Ä–µ–±–µ–Ω–æ–∫ –≤—ã—à–µ
            } else if (childNumber === 2) {
                childY = parentY; // –í—Ç–æ—Ä–æ–π —Ä–µ–±–µ–Ω–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–æ–¥–∏—Ç–µ–ª—è
            } else if (childNumber === 3) {
                childY = parentY + 120; // –¢—Ä–µ—Ç–∏–π —Ä–µ–±–µ–Ω–æ–∫ –Ω–∏–∂–µ
            } else {
                // –ï—Å–ª–∏ –¥–µ—Ç–µ–π –±–æ–ª—å—à–µ 3, —Ä–∞–∑–º–µ—â–∞–µ–º –∏—Ö –¥–∞–ª—å—à–µ –≤–Ω–∏–∑
                childY = parentY + 120 + ((childNumber - 3) * 80);
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —É–∑–µ–ª
            const newChild = createNode(newChildId, `${newChildName}`, targetLevel, { x: childX, y: childY }, { humanName, uniqueId });
            newChild.setAttribute('data-parent', targetParent.id);
            newChild.setAttribute('data-created-by-click', 'true');
            newChild.setAttribute('data-human-name', humanName);
            
            container.appendChild(newChild);
            
            // –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑—å
            setTimeout(() => {
                createSingleConnection(targetParent, newChild);
                updateStats();
                
                console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä—Ç–Ω–µ—Ä: ${newChildName} (${humanName}) –∫ —Ä–æ–¥–∏—Ç–µ–ª—é ${targetParent.id}`);
                
                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
                newChild.style.animation = 'fadeIn 0.5s ease-in';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                const statusElement = document.getElementById('statusMessage');
                if (statusElement) {
                    statusElement.textContent = `‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä—Ç–Ω–µ—Ä ${humanName} (${newChildName})! –í—Å–µ–≥–æ —É–∑–ª–æ–≤: ${container.querySelectorAll('.user-card').length}`;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
                savePartnerStructure();
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
                recalculatePositionsOnChange();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –≤ –ë–î
                const parentUid = targetParent.getAttribute('data-uid') || targetParent.id;
                const partnerData = {
                    unique_id: uniqueId,
                    human_name: humanName,
                    level: targetLevel,
                    position_x: childX,
                    position_y: childY,
                    parent_id: parentUid
                };
                savePartnerToDB(partnerData);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö
                checkAndUpgradeLevel(targetParent);
                checkAllPartners();
                
            }, 100);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
        function savePartnerStructure() {
            const container = document.getElementById('mindmapContainer');
            const allCards = container.querySelectorAll('.user-card');
            
            const structure = [];
            allCards.forEach(card => {
                if (card.getAttribute('data-created-by-click') === 'true') {
                    structure.push({
                        id: card.id,
                        name: card.querySelector('.user-name').textContent,
                        level: card.getAttribute('data-level'),
                        parent: card.getAttribute('data-parent'),
                        x: parseInt(card.style.left) || 0,
                        y: parseInt(card.style.top) || 0,
                        timestamp: Date.now()
                    });
                }
            });
            
            localStorage.setItem('mlm_partner_structure', JSON.stringify(structure));
            console.log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: ${structure.length} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤`);
        }

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–µ–∑ –Ω–∞–ª–æ–∂–µ–Ω–∏–π
        function autoLayoutNoOverlap() {
            const container = document.getElementById('mindmapContainer');
            const nodes = Array.from(container.querySelectorAll('.user-card'));
            if (nodes.length === 0) return;

            console.log('üé® –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫—É –±–µ–∑ –Ω–∞–ª–æ–∂–µ–Ω–∏–π...');

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ—Ä–µ–Ω—å (IVA)
            let root = container.querySelector('#iva-main-partner') || nodes.find(n => !n.getAttribute('data-parent'));
            if (!root) root = nodes[0];

            // –†–∞–∑–º–µ—Ä—ã –∫–∞—Ä—Ç–æ—á–∫–∏ (—É—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã)
            const CARD_WIDTH = 200;
            const CARD_HEIGHT = 80;
            const HORIZONTAL_GAP = 300; // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏
            const VERTICAL_GAP = 150;   // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –≤ –∫–æ–ª–æ–Ω–∫–µ

            // –†–∞–∑–º–µ—â–∞–µ–º IVA —Å–ª–µ–≤–∞
            const IVA_X = 50;
            const IVA_Y = 400; // —Ü–µ–Ω—Ç—Ä –ø–æ –≤—ã—Å–æ—Ç–µ
            root.style.left = IVA_X + 'px';
            root.style.top = IVA_Y + 'px';
            console.log(`üëë IVA —Ä–∞–∑–º–µ—â–µ–Ω–∞: ${IVA_X}, ${IVA_Y}`);

            // –°—Ç—Ä–æ–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ —É—Ä–æ–≤–Ω—è–º —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–ª–ª–∏–∑–∏–π
            const levels = new Map();
            const processed = new Set();

            // –£—Ä–æ–≤–µ–Ω—å 0 - IVA
            levels.set(0, [root]);
            processed.add(root.id);

            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —É—Ä–æ–≤–Ω–∏
            let currentLevel = 0;
            while (true) {
                const currentLevelNodes = levels.get(currentLevel) || [];
                const nextLevelNodes = [];

                currentLevelNodes.forEach(parent => {
                    const children = nodes.filter(n => 
                        n.getAttribute('data-parent') === parent.id && !processed.has(n.id)
                    );
                    
                    children.forEach(child => {
                        nextLevelNodes.push(child);
                        processed.add(child.id);
                    });
                });

                if (nextLevelNodes.length === 0) break;
                
                currentLevel++;
                levels.set(currentLevel, nextLevelNodes);
            }

            console.log(`üìä –ù–∞–π–¥–µ–Ω–æ —É—Ä–æ–≤–Ω–µ–π: ${currentLevel + 1}`);

            // –†–∞–∑–º–µ—â–∞–µ–º –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å
            for (let level = 1; level <= currentLevel; level++) {
                const levelNodes = levels.get(level) || [];
                if (levelNodes.length === 0) continue;

                const levelX = IVA_X + (level * HORIZONTAL_GAP);
                
                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ä–æ–¥–∏—Ç–µ–ª—è–º –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
                const byParent = new Map();
                levelNodes.forEach(node => {
                    const parentId = node.getAttribute('data-parent');
                    if (!byParent.has(parentId)) byParent.set(parentId, []);
                    byParent.get(parentId).push(node);
                });

                // –†–∞–∑–º–µ—â–∞–µ–º –∫–∞–∂–¥—É—é –≥—Ä—É–ø–ø—É
                byParent.forEach((children, parentId) => {
                    const parent = nodes.find(n => n.id === parentId);
                    if (!parent) return;

                    const parentY = parseInt(parent.style.top) || 0;
                    
                    // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≥—Ä—É–ø–ø—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—è
                    const groupStartY = parentY - ((children.length - 1) * VERTICAL_GAP) / 2;
                    
                    children.forEach((child, index) => {
                        const childY = groupStartY + (index * VERTICAL_GAP);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏–∏ —Å —É–∂–µ —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
                        const finalY = resolveCollision(levelX, childY, CARD_WIDTH, CARD_HEIGHT, nodes);
                        
                        child.style.left = levelX + 'px';
                        child.style.top = finalY + 'px';
                        
                        console.log(`üìç –ö–∞—Ä—Ç–æ—á–∫–∞ ${child.id}: X=${levelX}, Y=${finalY}`);
                    });
                });
            }

            // –î–ò–ù–ê–ú–ò–ß–ï–°–ö–û–ï –¶–ï–ù–¢–†–ò–†–û–í–ê–ù–ò–ï IVA
            centerIVADynamically(root, nodes);
            
            console.log('‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞!');
        }

        // –ù–æ–≤–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ –ø—Ä–∏–º–µ—Ä—É: –∫–æ—Ä–µ–Ω—å —Å–ª–µ–≤–∞, –ø–æ—Ç–æ–º–∫–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º
        function autoLayout111() {
            const container = document.getElementById('mindmapContainer');
            if (!container) {
                console.warn('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä mindmapContainer –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            const cards = Array.from(container.querySelectorAll('.user-card'));
            if (cards.length === 0) {
                console.log('‚ÑπÔ∏è –ù–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏');
                return;
            }

            const cardsById = new Map();
            cards.forEach(card => cardsById.set(card.id, card));

            let root = cards.find(card => card.getAttribute('data-is-iva') === 'true');
            if (!root) {
                root = cards.find(card => !card.getAttribute('data-parent')) || cards[0];
            }

            const childrenMap = new Map();
            cards.forEach(card => {
                const parentId = card.getAttribute('data-parent');
                if (!parentId) {
                    return;
                }
                if (!cardsById.has(parentId)) {
                    return;
                }
                if (!childrenMap.has(parentId)) {
                    childrenMap.set(parentId, []);
                }
                childrenMap.get(parentId).push(card);
            });

            childrenMap.forEach(children => {
                children.sort((a, b) => {
                    const aTop = parseInt(a.style.top, 10) || 0;
                    const bTop = parseInt(b.style.top, 10) || 0;
                    if (aTop !== bTop) {
                        return aTop - bTop;
                    }
                    const aNameNode = a.querySelector('.user-name');
                    const bNameNode = b.querySelector('.user-name');
                    const aName = aNameNode ? aNameNode.textContent.trim() : '';
                    const bName = bNameNode ? bNameNode.textContent.trim() : '';
                    return aName.localeCompare(bName, 'ru', { sensitivity: 'base' });
                });
            });

            const HORIZONTAL_GAP = 280;
            const VERTICAL_GAP = 150;
            const START_X = 80;
            const START_Y = 260;

            const positions = new Map();
            let currentY = START_Y;

            // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å—Ç—Ä–æ–∏–º –¥–µ—Ä–µ–≤–æ –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ä–æ–¥–∏—Ç–µ–ª–µ–π –Ω–∞–¥ –ø–æ—Ç–æ–º–∫–∞–º–∏
            function placeCard(card, depth) {
                const children = childrenMap.get(card.id) || [];
                const x = START_X + depth * HORIZONTAL_GAP;

                if (children.length === 0) {
                    const leafY = currentY;
                    currentY += VERTICAL_GAP;
                    positions.set(card.id, { x, y: leafY });
                    return leafY;
                }

                const childYs = children.map(child => placeCard(child, depth + 1));
                const firstY = Math.min.apply(null, childYs);
                const lastY = Math.max.apply(null, childYs);
                const centeredY = (firstY + lastY) / 2;

                positions.set(card.id, { x, y: centeredY });
                return centeredY;
            }

            placeCard(root, 0);

            cards.forEach(card => {
                if (!positions.has(card.id)) {
                    const levelValue = parseInt(card.getAttribute('data-level'), 10);
                    const level = Number.isFinite(levelValue) ? levelValue : 0;
                    const fallbackX = START_X + Math.max(level, 0) * HORIZONTAL_GAP;
                    const fallbackY = currentY;
                    currentY += VERTICAL_GAP;
                    positions.set(card.id, { x: fallbackX, y: fallbackY });
                }
            });

            positions.forEach((point, cardId) => {
                const card = cardsById.get(cardId);
                if (!card) {
                    return;
                }
                card.style.left = point.x + 'px';
                card.style.top = point.y + 'px';
            });

            rebuildConnections();

            const statusElement = document.getElementById('statusMessage');
            if (statusElement) {
                statusElement.textContent = '‚úÖ –†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ 111 –ø—Ä–∏–º–µ–Ω–µ–Ω–∞';
            }
            console.log('‚úÖ –†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ 111 –ø—Ä–∏–º–µ–Ω–µ–Ω–∞');
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–ª–ª–∏–∑–∏–π
        function resolveCollision(x, y, width, height, allNodes) {
            const VERTICAL_GAP = 150;
            const MIN_DISTANCE = height + 20; // –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
            
            let finalY = y;
            let attempts = 0;
            const maxAttempts = 100;

            while (attempts < maxAttempts) {
                let hasCollision = false;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏–∏ —Å —É–∂–µ —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
                for (const node of allNodes) {
                    const nodeX = parseInt(node.style.left) || 0;
                    const nodeY = parseInt(node.style.top) || 0;
                    
                    // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ X
                    if (Math.abs(nodeX - x) < width) {
                        const distanceY = Math.abs(nodeY - finalY);
                        
                        // –ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –ø–æ Y
                        if (distanceY < MIN_DISTANCE) {
                            hasCollision = true;
                            // –°–¥–≤–∏–≥–∞–µ–º –≤–Ω–∏–∑
                            finalY = nodeY + MIN_DISTANCE;
                            break;
                        }
                    }
                }

                if (!hasCollision) break;
                attempts++;
            }

            return finalY;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è IVA
        function centerIVADynamically(iva, allNodes) {
            if (allNodes.length <= 1) return;

            console.log('üéØ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ IVA...');

            // –ù–∞—Ö–æ–¥–∏–º –≥—Ä–∞–Ω–∏—Ü—ã –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            let minY = Infinity, maxY = -Infinity;
            let minX = Infinity, maxX = -Infinity;

            allNodes.forEach(node => {
                const x = parseInt(node.style.left) || 0;
                const y = parseInt(node.style.top) || 0;
                
                minX = Math.min(minX, x);
                maxX = Math.max(maxX, x);
                minY = Math.min(minY, y);
                maxY = Math.max(maxY, y);
            });

            // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            const structureCenterY = (minY + maxY) / 2;
            const structureCenterX = (minX + maxX) / 2;

            console.log(`üìä –ì—Ä–∞–Ω–∏—Ü—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: Y(${minY}-${maxY}), X(${minX}-${maxX})`);
            console.log(`üéØ –¶–µ–Ω—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: Y=${structureCenterY}, X=${structureCenterX}`);

            // –†–∞–∑–º–µ—â–∞–µ–º IVA —Å–ª–µ–≤–∞ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            const IVA_FINAL_X = Math.max(50, structureCenterX - 400); // IVA —Å–ª–µ–≤–∞ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞
            const IVA_FINAL_Y = structureCenterY; // IVA –ø–æ —Ü–µ–Ω—Ç—Ä—É –ø–æ –≤—ã—Å–æ—Ç–µ

            iva.style.left = IVA_FINAL_X + 'px';
            iva.style.top = IVA_FINAL_Y + 'px';

            console.log(`üëë IVA —Ä–∞–∑–º–µ—â–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏: X=${IVA_FINAL_X}, Y=${IVA_FINAL_Y}`);

            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏ IVA
            recalculateAllPositions(iva, allNodes);
        }

        // –ü–µ—Ä–µ—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–π –≤—Å–µ—Ö —É–∑–ª–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ IVA
        function recalculateAllPositions(iva, allNodes) {
            console.log('üîÑ –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤—Å–µ—Ö —É–∑–ª–æ–≤...');

            const IVA_X = parseInt(iva.style.left) || 0;
            const IVA_Y = parseInt(iva.style.top) || 0;

            // –ù–∞—Ö–æ–¥–∏–º –ø—Ä—è–º—ã—Ö –¥–µ—Ç–µ–π IVA
            const directChildren = allNodes.filter(n => n.getAttribute('data-parent') === iva.id);
            
            if (directChildren.length > 0) {
                const CHILDREN_X = IVA_X + 250; // —Å–ø—Ä–∞–≤–∞ –æ—Ç IVA
                const CHILDREN_GAP = 120;

                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –¥–µ—Ç–µ–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ IVA
                const totalHeight = directChildren.length * CHILDREN_GAP;
                const startY = IVA_Y - (totalHeight / 2) + (CHILDREN_GAP / 2);

                directChildren.forEach((child, index) => {
                    const y = startY + index * CHILDREN_GAP;
                    child.style.left = CHILDREN_X + 'px';
                    child.style.top = y + 'px';
                });

                // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏
                recalculateChildrenPositions(directChildren, allNodes);
            }
        }

        // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–π –¥–µ—Ç–µ–π
        function recalculateChildrenPositions(parents, allNodes) {
            parents.forEach(parent => {
                const children = allNodes.filter(n => n.getAttribute('data-parent') === parent.id);
                if (children.length === 0) return;

                const parentX = parseInt(parent.style.left) || 0;
                const parentY = parseInt(parent.style.top) || 0;
                const CHILDREN_GAP = 120;
                const CHILDREN_X = parentX + 250;

                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –¥–µ—Ç–µ–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—è
                const groupStartY = parentY - ((children.length - 1) * CHILDREN_GAP) / 2;

                children.forEach((child, index) => {
                    const y = groupStartY + index * CHILDREN_GAP;
                    child.style.left = CHILDREN_X + 'px';
                    child.style.top = y + 'px';
                });

                // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–Ω—É–∫–æ–≤
                recalculateChildrenPositions(children, allNodes);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è autoLayout111 - —Å—Ç—Ä–æ–∏—Ç –¥–µ—Ä–µ–≤–æ –æ—Ç –∫–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ –≤—ã—Å–æ—Ç–µ
        function autoLayout111() {
            console.log('üéØ –ó–∞–ø—É—Å–∫–∞–µ–º autoLayout111 —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ –≤—ã—Å–æ—Ç–µ...');
            
            const container = document.getElementById('mindmapContainer');
            const nodes = Array.from(container.querySelectorAll('.user-card'));
            if (nodes.length === 0) {
                console.log('‚ùå –ù–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏');
                return;
            }

            // –ù–∞—Ö–æ–¥–∏–º –∫–æ—Ä–Ω–µ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É (IVA)
            let root = container.querySelector('#iva-main-partner') || nodes.find(n => !n.getAttribute('data-parent'));
            if (!root) root = nodes[0];

            console.log(`üëë –ö–æ—Ä–Ω–µ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞: ${root.id}`);

            // –°—Ç—Ä–æ–∏–º –¥–µ—Ä–µ–≤–æ –ø–æ —É—Ä–æ–≤–Ω—è–º
            const levels = new Map();
            const processed = new Set();

            // –£—Ä–æ–≤–µ–Ω—å 0 - –∫–æ—Ä–µ–Ω—å
            levels.set(0, [root]);
            processed.add(root.id);

            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —É—Ä–æ–≤–Ω–∏
            let currentLevel = 0;
            while (true) {
                const currentLevelNodes = levels.get(currentLevel) || [];
                const nextLevelNodes = [];

                currentLevelNodes.forEach(parent => {
                    const children = nodes.filter(n => 
                        n.getAttribute('data-parent') === parent.id && !processed.has(n.id)
                    );
                    
                    children.forEach(child => {
                        nextLevelNodes.push(child);
                        processed.add(child.id);
                    });
                });

                if (nextLevelNodes.length === 0) break;
                
                currentLevel++;
                levels.set(currentLevel, nextLevelNodes);
            }

            console.log(`üìä –ù–∞–π–¥–µ–Ω–æ —É—Ä–æ–≤–Ω–µ–π: ${currentLevel + 1}`);

            // –†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å
            const LEVEL_GAP = 300; // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏
            const VERTICAL_GAP = 120; // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
            const ROOT_X = 50; // IVA —Å–ª–µ–≤–∞

            // –°–Ω–∞—á–∞–ª–∞ —Ä–∞–∑–º–µ—â–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—â–µ–π –≤—ã—Å–æ—Ç—ã
            const levelPositions = new Map();
            
            for (let level = 0; level <= currentLevel; level++) {
                const levelNodes = levels.get(level) || [];
                if (levelNodes.length === 0) continue;

                const levelX = ROOT_X + (level * LEVEL_GAP);
                const totalHeight = levelNodes.length * VERTICAL_GAP;
                
                levelPositions.set(level, {
                    x: levelX,
                    totalHeight: totalHeight,
                    nodes: levelNodes
                });
            }

            // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π
            const maxHeight = Math.max(...Array.from(levelPositions.values()).map(pos => pos.totalHeight));
            const CONTAINER_CENTER_Y = 300; // —Ü–µ–Ω—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ –≤—ã—Å–æ—Ç–µ

            console.log(`üìè –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: ${maxHeight}px`);

            // –†–∞–∑–º–µ—â–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º
            levelPositions.forEach((position, level) => {
                const { x, totalHeight, nodes } = position;
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ–±—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞
                const startY = CONTAINER_CENTER_Y - (totalHeight / 2) + (VERTICAL_GAP / 2);

                nodes.forEach((node, index) => {
                    const y = startY + (index * VERTICAL_GAP);
                    node.style.left = x + 'px';
                    node.style.top = y + 'px';
                    
                    console.log(`üìç –£—Ä–æ–≤–µ–Ω—å ${level}, –ö–∞—Ä—Ç–æ—á–∫–∞ ${node.id}: X=${x}, Y=${y}`);
                });
            });

            // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–≤—è–∑–∏
            rebuildConnections();

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É
            const statusMessage = document.getElementById('statusMessage');
            if (statusMessage) {
                statusMessage.textContent = `‚úÖ –†–ê–°–°–¢–ê–ù–û–í–ö–ê 111 –ø—Ä–∏–º–µ–Ω–µ–Ω–∞! –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ –≤—ã—Å–æ—Ç–µ, —É—Ä–æ–≤–Ω–µ–π: ${currentLevel + 1}, –∫–∞—Ä—Ç–æ—á–µ–∫: ${nodes.length}`;
            }

            console.log('‚úÖ autoLayout111 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ –≤—ã—Å–æ—Ç–µ!');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–∞ –ø–æ–¥–ª–æ–∂–∫–∏
        function enableBackgroundScrolling() {
            console.log('üñ±Ô∏è –í–∫–ª—é—á–∞–µ–º —Å–∫—Ä–æ–ª–ª–∏–Ω–≥ –ø–æ–¥–ª–æ–∂–∫–∏...');
            
            const container = document.getElementById('mindmapContainer');
            if (!container) return;

            let isDragging = false;
            let startX = 0;
            let startY = 0;
            let scrollLeft = 0;
            let scrollTop = 0;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            container.addEventListener('mousedown', (e) => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –Ω–µ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ
                if (e.target.classList.contains('user-card') || 
                    e.target.closest('.user-card')) {
                    return;
                }

                isDragging = true;
                startX = e.pageX - container.offsetLeft;
                startY = e.pageY - container.offsetTop;
                scrollLeft = container.scrollLeft;
                scrollTop = container.scrollTop;
                
                container.style.cursor = 'grabbing';
                e.preventDefault();
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏
            container.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                e.preventDefault();
                const x = e.pageX - container.offsetLeft;
                const y = e.pageY - container.offsetTop;
                const walkX = (x - startX) * 2; // –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–∫—Ä–æ–ª–ª–∞
                const walkY = (y - startY) * 2;
                
                container.scrollLeft = scrollLeft - walkX;
                container.scrollTop = scrollTop - walkY;
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è –º—ã—à–∏
            container.addEventListener('mouseup', () => {
                isDragging = false;
                container.style.cursor = 'grab';
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–∞ –º—ã—à–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            container.addEventListener('mouseleave', () => {
                isDragging = false;
                container.style.cursor = 'grab';
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–ª–µ—Å–∏–∫–∞ –º—ã—à–∏ –¥–ª—è –∑—É–º–∞
            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –ø—Ä–∏ –∑–∞–∂–∞—Ç–æ–º Shift
                if (e.shiftKey) {
                    container.scrollLeft += e.deltaY;
                } else {
                    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª
                    container.scrollTop += e.deltaY;
                }
            }, { passive: false });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä
            container.style.cursor = 'grab';
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞
            container.style.width = '200vw';
            container.style.height = '200vh';
            container.style.overflow = 'auto';
            
            console.log('‚úÖ –°–∫—Ä–æ–ª–ª–∏–Ω–≥ –ø–æ–¥–ª–æ–∂–∫–∏ –≤–∫–ª—é—á–µ–Ω!');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–∞ –ø–æ–¥–ª–æ–∂–∫–∏
        function disableBackgroundScrolling() {
            console.log('üñ±Ô∏è –û—Ç–∫–ª—é—á–∞–µ–º —Å–∫—Ä–æ–ª–ª–∏–Ω–≥ –ø–æ–¥–ª–æ–∂–∫–∏...');
            
            const container = document.getElementById('mindmapContainer');
            if (!container) return;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã
            container.style.width = '100%';
            container.style.height = '100%';
            container.style.overflow = 'hidden';
            container.style.cursor = 'default';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞
            container.scrollLeft = 0;
            container.scrollTop = 0;
            
            console.log('‚úÖ –°–∫—Ä–æ–ª–ª–∏–Ω–≥ –ø–æ–¥–ª–æ–∂–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω!');
        }
        
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è IVA –∫–∞–∫ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ Level 0*
        function addIVAPartner() {
            console.log('üëë –î–æ–±–∞–≤–ª—è–µ–º IVA –∫–∞–∫ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ Level 0*');
            
            const container = document.getElementById('mindmapContainer');
            
            if (!container) {
                console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–∏ —É–∂–µ IVA
            const existingIVA = container.querySelector('#iva-main-partner');
            if (existingIVA) {
                console.log('üëë IVA —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å');
                updateIVALevel();
                return;
            }
            
            console.log('üì¶ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º IVA...');
            
            // –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥—Ö–æ–¥—è—â—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è IVA (—Å–ª–µ–≤–∞ –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –ø–æ —Ü–µ–Ω—Ç—Ä—É –ø–æ –≤—ã—Å–æ—Ç–µ)
            const ivaX = 0; // –°–ª–µ–≤–∞ –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            const ivaY = window.innerHeight / 2 - 100;  // –ü–æ —Ü–µ–Ω—Ç—Ä—É —ç–∫—Ä–∞–Ω–∞ –ø–æ –≤—ã—Å–æ—Ç–µ
            
            console.log(`üìç –ü–æ–∑–∏—Ü–∏—è IVA: x=${ivaX}, y=${ivaY}`);
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É IVA
            const ivaCard = createNode('iva-main-partner', 'IVA (0*)', 0, { x: ivaX, y: ivaY });
            
            if (!ivaCard) {
                console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É IVA');
                return;
            }
            
            ivaCard.setAttribute('data-is-iva', 'true');
            ivaCard.setAttribute('data-iva-level', '0');
            ivaCard.setAttribute('data-created-by-click', 'true');
            
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è IVA (–Ω–æ —Å —É—á–µ—Ç–æ–º —É—Ä–æ–≤–Ω—è)
            // –¶–≤–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ data-level —á–µ—Ä–µ–∑ CSS
            ivaCard.style.fontWeight = 'bold';
            ivaCard.style.border = '3px solid rgba(0, 0, 0, 0.3)';
            ivaCard.style.fontSize = '16px';
            ivaCard.style.minWidth = '140px';
            ivaCard.style.minHeight = '70px';
            
            console.log('üìù IVA –∫–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä...');
            container.appendChild(ivaCard);
            
            console.log('‚úÖ IVA –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–∞–∫ Level 0* –ø–∞—Ä—Ç–Ω–µ—Ä');
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
            ivaCard.style.animation = 'fadeIn 0.8s ease-in';
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            setTimeout(() => {
                savePartnerStructure();
                updateStats();
                console.log('üíæ IVA —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage');
            }, 100);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è IVA –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–∞–Ω–¥—ã
        function calculateIVALevel() {
            const container = document.getElementById('mindmapContainer');
            const ivaCard = container.querySelector('#iva-main-partner');
            if (!ivaCard) return 0;
            
            const currentLevel = parseInt(ivaCard.getAttribute('data-level')) || 0;
            console.log(`üîç –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è IVA: —Ç–µ–∫—É—â–∏–π = ${currentLevel}*`);
            
            // –ò—â–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –¢–ï–ö–£–©–ï–ì–û —É—Ä–æ–≤–Ω—è
            const targetLevel = currentLevel;
            const partnerCount = countPartnersAtLevel(ivaCard, targetLevel);
            
            console.log(`üìä IVA Level ${currentLevel}*: –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ Level ${targetLevel}* = ${partnerCount}`);
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å 3+ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è, –º–æ–∂–µ–º –ø–æ–≤—ã—Å–∏—Ç—å—Å—è
            if (partnerCount >= 3 && currentLevel < 7) {
                const newLevel = currentLevel + 1;
                console.log(`üéØ –í—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å IVA: ${newLevel}* (–ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ ${targetLevel}*: ${partnerCount})`);
                return newLevel;
            }
            
            console.log(`üéØ –í—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å IVA: ${currentLevel}* (–ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ ${targetLevel}*: ${partnerCount})`);
            return currentLevel;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è IVA
        function updateIVALevel() {
            const container = document.getElementById('mindmapContainer');
            const ivaCard = container.querySelector('#iva-main-partner');
            if (!ivaCard) return;
            
            const currentLevel = parseInt(ivaCard.getAttribute('data-iva-level')) || 0;
            const newLevel = calculateIVALevel();
            
            if (currentLevel !== newLevel) {
                console.log(`üöÄ –ü–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è IVA: ${currentLevel}* ‚Üí ${newLevel}*`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã
                ivaCard.setAttribute('data-iva-level', newLevel.toString());
                ivaCard.setAttribute('data-level', newLevel.toString());
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏
                const nameElement = ivaCard.querySelector('.user-name');
                if (nameElement) {
                    nameElement.textContent = `IVA (${newLevel}*)`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø–æ–≤—ã—à–µ–Ω–∏—è
                if (newLevel > currentLevel) {
                    ivaCard.style.animation = 'none';
                    setTimeout(() => {
                        ivaCard.style.animation = 'fadeIn 0.5s ease-in';
                        ivaCard.style.transform = 'scale(1.1)';
                        setTimeout(() => {
                            ivaCard.style.transform = 'scale(1)';
                        }, 500);
                    }, 10);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                    const statusElement = document.getElementById('statusMessage');
                    if (statusElement) {
                        statusElement.textContent = `üöÄ IVA –ø–æ–≤—ã—à–µ–Ω–∞ –¥–æ —É—Ä–æ–≤–Ω—è ${newLevel}*! –ö–æ–º–∞–Ω–¥–∞: ${calculateTeamSize()} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤`;
                    }
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                savePartnerStructure();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–º–∞–Ω–¥—ã
        function calculateTeamSize() {
            const container = document.getElementById('mindmapContainer');
            const allPartners = container.querySelectorAll('.user-card[data-created-by-click="true"]');
            return Array.from(allPartners).filter(card => card.id !== 'iva-main-partner').length;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
        function loadPartnerStructure() {
            const saved = localStorage.getItem('mlm_partner_structure');
            if (!saved) {
                console.log('üìÇ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                return;
            }
            
            try {
                const structure = JSON.parse(saved);
                console.log(`üìÇ –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É: ${structure.length} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤`);
                
                const container = document.getElementById('mindmapContainer');
                
                structure.forEach(partnerData => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–æ–¥–∏—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                    const parentCard = container.querySelector(`#${partnerData.parent}`);
                    if (parentCard) {
                        const newChild = createNode(
                            partnerData.id, 
                            partnerData.name, 
                            parseInt(partnerData.level), 
                            { x: partnerData.x, y: partnerData.y }
                        );
                        newChild.setAttribute('data-parent', partnerData.parent);
                        newChild.setAttribute('data-created-by-click', 'true');
                        
                        container.appendChild(newChild);
                        
                        // –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑—å
                        setTimeout(() => {
                            createSingleConnection(parentCard, newChild);
                        }, 50);
                    }
                });
                
                setTimeout(() => {
                    updateStats();
                    // –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å IVA –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                    updateIVALevel();
                    console.log('‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                }, 200);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:', error);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
        function enableDragForAllCards() {
            console.log('üñ±Ô∏è –í–∫–ª—é—á–∞–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫...');
            
            const allCards = document.querySelectorAll('.user-card');
            let enabledCount = 0;
            
            allCards.forEach(card => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤–∫–ª—é—á–µ–Ω–æ –ª–∏ —É–∂–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
                if (!card.hasAttribute('data-draggable')) {
                    makeDraggable(card);
                    card.setAttribute('data-draggable', 'true');
                    enabledCount++;
                }
            });
            
            console.log(`‚úÖ –í–∫–ª—é—á–µ–Ω–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è ${enabledCount} –∫–∞—Ä—Ç–æ—á–µ–∫ –∏–∑ ${allCards.length}`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            const statusElement = document.getElementById('statusMessage');
            if (statusElement) {
                statusElement.textContent = `üñ±Ô∏è –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ –¥–ª—è ${allCards.length} –∫–∞—Ä—Ç–æ—á–µ–∫! –¢—è–Ω–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –º—ã—à—å—é`;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
        function clearPartnerStructure() {
            if (confirm('üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                // –£–¥–∞–ª—è–µ–º –∏–∑ localStorage
                localStorage.removeItem('mlm_partner_structure');
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ DOM
                const container = document.getElementById('mindmapContainer');
                const partnerCards = container.querySelectorAll('.user-card[data-created-by-click="true"]');
                
                console.log(`üóëÔ∏è –£–¥–∞–ª—è–µ–º ${partnerCards.length} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤...`);
                
                partnerCards.forEach(card => {
                    card.remove();
                });
                
                // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–≤—è–∑–∏
                setTimeout(() => {
                    rebuildConnections();
                    updateStats();
                    
                    const statusElement = document.getElementById('statusMessage');
                    if (statusElement) {
                        statusElement.textContent = `üóëÔ∏è –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –ø–∞—Ä—Ç–Ω–µ—Ä—ã! –û—Å—Ç–∞–ª–æ—Å—å —É–∑–ª–æ–≤: ${container.querySelectorAll('.user-card').length}`;
                    }
                    
                    console.log('‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –æ—á–∏—â–µ–Ω–∞');
                }, 100);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é (—Ç–æ–ª—å–∫–æ IVA)
        function resetToIVAOnly() {
            if (confirm('üëë –°–±—Ä–æ—Å–∏—Ç—å –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é? –û—Å—Ç–∞–Ω–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ + IVA')) {
                console.log('üëë –°–±—Ä–æ—Å –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é —Å IVA...');
                
                // –û—á–∏—â–∞–µ–º localStorage
                localStorage.removeItem('mlm_partner_structure');
                
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∫—Ä–æ–º–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                const container = document.getElementById('mindmapContainer');
                const partnerCards = container.querySelectorAll('.user-card[data-created-by-click="true"]');
                
                console.log(`üóëÔ∏è –£–¥–∞–ª—è–µ–º ${partnerCards.length} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤...`);
                
                partnerCards.forEach(card => {
                    card.remove();
                });
                
                // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–≤—è–∑–∏
                setTimeout(() => {
                    rebuildConnections();
                    updateStats();
                    
                    const statusElement = document.getElementById('statusMessage');
                    if (statusElement) {
                        statusElement.textContent = 'üëë –°–±—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω! –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —É–∑–ª—ã (IVA –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ Level 3)';
                    }
                    
                    console.log('‚úÖ –°–±—Ä–æ—Å –∫ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å IVA –∑–∞–≤–µ—Ä—à–µ–Ω');
                }, 100);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏ IVA
        function showIVAProgression() {
            const container = document.getElementById('mindmapContainer');
            const ivaCard = container.querySelector('#iva-main-partner');
            
            let currentLevel = 0;
            let teamSize = 0;
            
            if (ivaCard) {
                currentLevel = parseInt(ivaCard.getAttribute('data-iva-level')) || 0;
                teamSize = calculateTeamSize();
            }
            
            const progression = `
üìà –ü–†–û–ì–†–ï–°–°–ò–Ø IVA - –°–ò–°–¢–ï–ú–ê –£–†–û–í–ù–ï–ô:

üëë –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°:
   ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å: ${currentLevel}*
   ‚Ä¢ –†–∞–∑–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã: ${teamSize} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤

üéØ –¢–†–ï–ë–û–í–ê–ù–ò–Ø –î–õ–Ø –ü–û–í–´–®–ï–ù–ò–Ø:
   ‚Ä¢ Level 0* ‚Üí 1*: 3 –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (${teamSize >= 3 ? '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ' : `‚ùå –ù—É–∂–Ω–æ –µ—â–µ ${3 - teamSize}`})
   ‚Ä¢ Level 1* ‚Üí 2*: 6 –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ (${teamSize >= 6 ? '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ' : `‚ùå –ù—É–∂–Ω–æ –µ—â–µ ${6 - teamSize}`})
   ‚Ä¢ Level 2* ‚Üí 3*: 12 –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ (${teamSize >= 12 ? '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ' : `‚ùå –ù—É–∂–Ω–æ –µ—â–µ ${12 - teamSize}`})
   ‚Ä¢ Level 3* ‚Üí 4*: 24 –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (${teamSize >= 24 ? '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ' : `‚ùå –ù—É–∂–Ω–æ –µ—â–µ ${24 - teamSize}`})

üöÄ –°–õ–ï–î–£–Æ–©–ò–ô –£–†–û–í–ï–ù–¨:
   ${currentLevel < 4 ? 
     `‚Ä¢ –î–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è ${currentLevel + 1}* –Ω—É–∂–Ω–æ ${[3, 6, 12, 24][currentLevel]} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
   ‚Ä¢ –î–æ –ø–æ–≤—ã—à–µ–Ω–∏—è –æ—Å—Ç–∞–ª–æ—Å—å: ${Math.max(0, [3, 6, 12, 24][currentLevel] - teamSize)} –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤` :
     '‚Ä¢ –î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å 4*! üèÜ'}

üí° –ö–ê–ö –î–û–ë–ê–í–õ–Ø–¢–¨ –ü–ê–†–¢–ù–ï–†–û–í:
   ‚Ä¢ –ö–ª–∏–∫–∞–π—Ç–µ –Ω–∞ –ª—é–±—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
   ‚Ä¢ –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É IVA
   ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–π
            `;
            
            alert(progression);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
        function showPartnerInstructions() {
            const instructions = `
üë• –ö–ê–ö –î–û–ë–ê–í–õ–Ø–¢–¨ –ü–ê–†–¢–ù–ï–†–û–í:

üëë IVA - –ü–ï–†–í–´–ô –ü–ê–†–¢–ù–ï–† LEVEL 0*:
   ‚Ä¢ IVA –Ω–∞—á–∏–Ω–∞–µ—Ç –∫–∞–∫ Level 0* –ø–∞—Ä—Ç–Ω–µ—Ä
   ‚Ä¢ –ó–µ–ª–µ–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å–ø—Ä–∞–≤–∞ –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   ‚Ä¢ –ü–æ–≤—ã—à–∞–µ—Ç—Å—è –≤ —É—Ä–æ–≤–Ω–µ –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ –∫–æ–º–∞–Ω–¥—ã

üñ±Ô∏è –ö–õ–ò–ö –ù–ê –ö–ê–†–¢–û–ß–ö–£:
   ‚Ä¢ –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±—É—é –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞
   ‚Ä¢ –ü–∞—Ä—Ç–Ω–µ—Ä –¥–æ–±–∞–≤–∏—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –Ω–∏–∂–µ (4‚Üí3, 3‚Üí2, 2‚Üí1, 1‚Üí0)

üß† –£–ú–ù–ê–Ø –õ–û–ì–ò–ö–ê:
   ‚Ä¢ –ï—Å–ª–∏ —É –∫–∞—Ä—Ç–æ—á–∫–∏ –º–µ–Ω—å—à–µ 3 –¥–µ—Ç–µ–π ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä—è–º–æ –∫ –Ω–µ–π
   ‚Ä¢ –ï—Å–ª–∏ —É –∫–∞—Ä—Ç–æ—á–∫–∏ —É–∂–µ 3 —Ä–µ–±–µ–Ω–∫–∞ ‚Üí –∏—â–µ—Ç—Å—è —Ä–µ–±–µ–Ω–æ–∫ —Å –º–∏–Ω–∏–º—É–º–æ–º –¥–µ—Ç–µ–π
   ‚Ä¢ –†–∞–∑–º–µ—â–µ–Ω–∏–µ: —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ (1-–π –≤—ã—à–µ, 2-–π –ø–æ —Ü–µ–Ω—Ç—Ä—É, 3-–π –Ω–∏–∂–µ)

üíæ –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï:
   ‚Ä¢ –í—Å–µ –ø–∞—Ä—Ç–Ω–µ—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   ‚Ä¢ –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
   ‚Ä¢ IVA –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–∞–∫ –ø–µ—Ä–≤—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä

üéØ –ü–û–†–Ø–î–û–ö –î–ï–ô–°–¢–í–ò–ô:
   1. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (üèóÔ∏è MLM —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
   2. IVA –ø–æ—è–≤–∏—Ç—Å—è –∫–∞–∫ Level 0* –ø–∞—Ä—Ç–Ω–µ—Ä —Å–ø—Ä–∞–≤–∞
   3. –ö–ª–∏–∫–∞–π—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –≤ –∫–æ–º–∞–Ω–¥—É IVA
   4. –°–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏—é IVA –∫–Ω–æ–ø–∫–æ–π "üìà –ü–†–û–ì–†–ï–°–°–ò–Ø IVA"
   5. IVA –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—ã—à–∞–µ—Ç—Å—è: 0*‚Üí1*‚Üí2*‚Üí3*‚Üí4*
            `;
            
            alert(instructions);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –Ω–æ–≤—ã–º–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è–º–∏
        function recreateStructureWithNewSpacing() {
            console.log('üìè –ü–ï–†–ï–°–û–ó–î–ê–ï–ú —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –Ω–æ–≤—ã–º–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è–º–∏...');
            
            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            const container = document.getElementById('mindmapContainer');
            const svg = document.getElementById('connectionsSvg') || document.getElementById('connectionSvg');
            
            if (container) {
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                const allCards = container.querySelectorAll('.user-card');
                console.log(`üóëÔ∏è –£–¥–∞–ª—è–µ–º ${allCards.length} —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫`);
                allCards.forEach(card => card.remove());
            }
            
            if (svg) {
                // –û—á–∏—â–∞–µ–º –≤—Å–µ —Å–≤—è–∑–∏
                while (svg.firstChild) {
                    svg.removeChild(svg.firstChild);
                }
                console.log('üóëÔ∏è –û—á–∏—â–µ–Ω—ã –≤—Å–µ —Å–≤—è–∑–∏');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            const statusElement = document.getElementById('statusMessage');
            if (statusElement) {
                statusElement.textContent = 'üîÑ –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –Ω–æ–≤—ã–º–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è–º–∏...';
            }
            
            // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
            setTimeout(() => {
                console.log('üèóÔ∏è –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è–º–∏...');
                generateIndividualStructures();
                
                if (statusElement) {
                    statusElement.textContent = '‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞ —Å –Ω–æ–≤—ã–º–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è–º–∏!';
                }
            }, 500);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–µ–ª–µ–Ω—ã—Ö —Ç–æ—á–µ–∫ –∫–æ –≤—Å–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —É–∑–ª–∞–º
        function addGreenPointsToAll() {
            console.log('üü¢ –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤–ª—è–µ–º –∑–µ–ª–µ–Ω—ã–µ —Ç–æ—á–∫–∏ –∫–æ –≤—Å–µ–º —É–∑–ª–∞–º...');
            
            const allCards = document.querySelectorAll('.user-card');
            let addedPoints = 0;
            let repairedPoints = 0;
            
            allCards.forEach(card => {
                const cardLevel = card.getAttribute('data-level');
                console.log(`üîç –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É ${card.id} (Level ${cardLevel})`);
                
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ç–æ—á–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
                const oldRightPoints = card.querySelectorAll('.connection-point.right');
                const oldLeftPoints = card.querySelectorAll('.connection-point.left');
                
                oldRightPoints.forEach(point => {
                    point.remove();
                    repairedPoints++;
                });
                oldLeftPoints.forEach(point => point.remove());
                
                // –°–æ–∑–¥–∞–µ–º –ª–µ–≤—É—é —Å–∏–Ω—é—é —Ç–æ—á–∫—É
                const leftConnectionPoint = document.createElement('div');
                leftConnectionPoint.className = 'connection-point left';
                card.appendChild(leftConnectionPoint);
                
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤—É—é –ó–ï–õ–ï–ù–£–Æ —Ç–æ—á–∫—É
                const rightConnectionPoint = document.createElement('div');
                rightConnectionPoint.className = 'connection-point right';
                rightConnectionPoint.title = '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª (–º–∞–∫—Å. 3)';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                rightConnectionPoint.addEventListener('click', function(e) {
                    e.stopPropagation();
                    console.log('üñ±Ô∏è –ö–ª–∏–∫ –ø–æ –∑–µ–ª–µ–Ω–æ–π —Ç–æ—á–∫–µ –∫–∞—Ä—Ç–æ—á–∫–∏:', card.id);
                    addChildNode(card);
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–≤–µ–¥–µ–Ω–∏—è
                rightConnectionPoint.addEventListener('mouseenter', function() {
                    console.log('üü¢ –ù–∞–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –∑–µ–ª–µ–Ω—É—é —Ç–æ—á–∫—É –∫–∞—Ä—Ç–æ—á–∫–∏:', card.id);
                });
                
                card.appendChild(rightConnectionPoint);
                addedPoints++;
                
                console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–µ–ª–µ–Ω–∞—è —Ç–æ—á–∫–∞ –∫ ${card.id} (Level ${cardLevel})`);
            });
            
            console.log(`‚úÖ –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤–ª–µ–Ω–æ –∑–µ–ª–µ–Ω—ã—Ö —Ç–æ—á–µ–∫: ${addedPoints} (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ${repairedPoints}) –∏–∑ ${allCards.length} –∫–∞—Ä—Ç–æ—á–µ–∫`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            const statusElement = document.getElementById('statusMessage');
            if (statusElement) {
                statusElement.textContent = `üü¢ –í–ï–ó–î–ï –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–µ–ª–µ–Ω—ã–µ —Ç–æ—á–∫–∏! –ö–∞—Ä—Ç–æ—á–µ–∫: ${allCards.length}, –¢–æ—á–µ–∫: ${addedPoints}`;
            }
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –¥–≤—É–º—è —É–∑–ª–∞–º–∏
        function createSingleConnection(parentCard, childCard) {
            const svg = document.getElementById('connectionsSvg') || document.getElementById('connectionSvg');
            if (!svg) {
                console.error('‚ùå SVG —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–≤—è–∑–∏ –æ—Ç —ç—Ç–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è –∫ —ç—Ç–∏–º –¥–µ—Ç—è–º
            const existingPaths = svg.querySelectorAll('.connection-line');
            existingPaths.forEach(path => {
                const pathParentId = path.getAttribute('data-parent-id');
                const pathChildId = path.getAttribute('data-child-id');
                
                // –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å–≤—è–∑–∏ –æ—Ç —ç—Ç–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è –∫ —ç—Ç–æ–º—É —Ä–µ–±–µ–Ω–∫—É
                if (pathParentId === parentCard.id && pathChildId === childCard.id) {
                    path.remove();
                    console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è —Å–≤—è–∑—å: ${pathParentId} ‚Üí ${pathChildId}`);
                }
            });
            
            const containerRect = document.getElementById('mindmapContainer').getBoundingClientRect();
            
            const parentRect = parentCard.getBoundingClientRect();
            const childRect = childCard.getBoundingClientRect();
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–∏–µ connection points –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
            const parentRightPoint = parentCard.querySelector('.connection-point.right');
            const childLeftPoint = childCard.querySelector('.connection-point.left');
            
            let parentX, parentY, childX, childY;
            
            if (parentRightPoint && childLeftPoint) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º connection points
                const parentPointRect = parentRightPoint.getBoundingClientRect();
                const childPointRect = childLeftPoint.getBoundingClientRect();
                
                parentX = parentPointRect.left - containerRect.left + parentPointRect.width / 2;
                parentY = parentPointRect.top - containerRect.top + parentPointRect.height / 2;
                childX = childPointRect.left - containerRect.left + childPointRect.width / 2;
                childY = childPointRect.top - containerRect.top + childPointRect.height / 2;
            } else {
                // Fallback –∫ —Ü–µ–Ω—Ç—Ä—É –∫–∞—Ä—Ç–æ—á–µ–∫
                parentX = parentRect.left - containerRect.left + parentRect.width / 2;
                parentY = parentRect.top - containerRect.top + parentRect.height / 2;
                childX = childRect.left - containerRect.left + childRect.width / 2;
                childY = childRect.top - containerRect.top + childRect.height / 2;
            }
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            
            // –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –∏–∑–æ–≥–Ω—É—Ç–æ–π –ª–∏–Ω–∏–∏
            const controlX1 = parentX + (childX - parentX) * 0.5;
            const controlY1 = parentY;
            const controlX2 = parentX + (childX - parentX) * 0.5;
            const controlY2 = childY;
            
            const pathData = `M ${parentX} ${parentY} C ${controlX1} ${controlY1}, ${controlX2} ${controlY2}, ${childX} ${childY}`;
            
            path.setAttribute('d', pathData);
            path.setAttribute('stroke', '#10B981'); // –ó–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –Ω–æ–≤—ã—Ö —Å–≤—è–∑–µ–π
            path.setAttribute('stroke-width', '3');
            path.setAttribute('fill', 'none');
            path.setAttribute('opacity', '1');
            path.setAttribute('class', 'connection-line dynamic-connection');
            path.setAttribute('data-parent-id', parentCard.id); // –î–æ–±–∞–≤–ª—è–µ–º ID —Ä–æ–¥–∏—Ç–µ–ª—è
            path.setAttribute('data-child-id', childCard.id); // –î–æ–±–∞–≤–ª—è–µ–º ID —Ä–µ–±–µ–Ω–∫–∞
            
            svg.appendChild(path);
            
            console.log(`‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–≤—è–∑—å: ${parentCard.id} ‚Üí ${childCard.id}`);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ—á–µ—Ä–Ω–µ–≥–æ —É–∑–ª–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø—Ä–∞–≤—É—é —Ç–æ—á–∫—É
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
        function countPartnersAtLevel(card, targetLevel) {
            const container = document.getElementById('mindmapContainer');
            const parentId = card.id;
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ—Ö –¥–µ—Ç–µ–π —ç—Ç–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            const children = container.querySelectorAll(`.user-card[data-parent="${parentId}"]`);
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–∫–æ–ª—å–∫–æ –∏–∑ –Ω–∏—Ö –∏–º–µ—é—Ç –Ω—É–∂–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
            let count = 0;
            children.forEach(child => {
                const childLevel = parseInt(child.getAttribute('data-level')) || 0;
                if (childLevel === targetLevel) {
                    count++;
                }
            });
            
            return count;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è –∫–∞—Ä—Ç–æ—á–∫–∏
        function checkAndUpgradeLevel(card) {
            const currentLevel = parseInt(card.getAttribute('data-level')) || 0;
            
            // –ù–µ –ø–æ–≤—ã—à–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –µ—Å–ª–∏ —É–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π (7*)
            if (currentLevel >= 7) {
                return;
            }
            
            // –ò—â–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –¢–ï–ö–£–©–ï–ì–û —É—Ä–æ–≤–Ω—è (–Ω–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ!)
            const targetLevel = currentLevel;
            const partnerCount = countPartnersAtLevel(card, targetLevel);
            
            console.log(`üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è –¥–ª—è ${card.id}: —Ç–µ–∫—É—â–∏–π = ${currentLevel}*, –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ ${targetLevel}* = ${partnerCount}`);
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å 3 –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –¢–ï–ö–£–©–ï–ì–û —É—Ä–æ–≤–Ω—è, –ø–æ–≤—ã—à–∞–µ–º —É—Ä–æ–≤–µ–Ω—å
            if (partnerCount >= 3) {
                const newLevel = currentLevel + 1;
                console.log(`üöÄ –ü–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è ${card.id}: ${currentLevel}* ‚Üí ${newLevel}*`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã
                card.setAttribute('data-level', newLevel.toString());
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ (–æ–±–µ —Å—Ç—Ä–æ–∫–∏)
                const nameElement = card.querySelector('.user-name');
                if (nameElement) {
                    const currentName = nameElement.textContent;
                    const newName = currentName.replace(/\d+\*/g, `${newLevel}*`);
                    nameElement.textContent = newName;
                }
                const idElement = card.querySelector('.user-id');
                if (idElement) {
                    const currentId = idElement.textContent;
                    const newId = currentId.replace(/\d+\*/g, `${newLevel}*`);
                    idElement.textContent = newId;
                }
                
                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
                card.style.animation = 'none';
                setTimeout(() => {
                    card.style.animation = 'pulse 0.5s ease-in';
                }, 10);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—è (–º–æ–∂–µ—Ç –æ–Ω —Ç–æ–∂–µ –ø–æ–≤—ã—Å–∏—Ç—Å—è)
                const parentId = card.getAttribute('data-parent');
                if (parentId) {
                    const parentCard = document.getElementById(parentId);
                    if (parentCard) {
                        setTimeout(() => {
                            checkAndUpgradeLevel(parentCard);
                        }, 200);
                    }
                }
                
                // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–≤—è–∑–∏
                setTimeout(() => {
                    rebuildConnections();
                }, 100);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ—Ö –¥–µ—Ç–µ–π (–º–æ–∂–µ—Ç –æ–Ω–∏ —Ç–æ–∂–µ –ø–æ–≤—ã—Å—è—Ç—Å—è)
                setTimeout(() => {
                    checkAllPartners();
                }, 100);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Ä–æ–≤–Ω—è –í–°–ï–• –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
        function checkAllPartners() {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–µ–Ω—å –í–°–ï–• –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤...');
            const container = document.getElementById('mindmapContainer');
            const allCards = container.querySelectorAll('.user-card');
            
            allCards.forEach(card => {
                checkAndUpgradeLevel(card);
            });
            
            console.log('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }
        
        function addChildNode(parentCard) {
            const parentLevel = parseInt(parentCard.getAttribute('data-level'));
            const childLevel = 0; // –í–°–ï–ì–î–ê —Å–æ–∑–¥–∞–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ Level 0*
            
            console.log(`‚ûï –î–æ–±–∞–≤–ª—è–µ–º –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª Level ${childLevel}* –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è Level ${parentLevel}*:`, parentCard.id);
            console.log(`üéØ –†–æ–¥–∏—Ç–µ–ª—å: Level ${parentLevel}, —Å–æ–∑–¥–∞–µ–º –¥–æ—á–µ—Ä–Ω–∏–π: Level ${childLevel}`);
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–µ—Ç–µ–π —ç—Ç–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è
            const container = document.getElementById('mindmapContainer');
            const existingChildren = container.querySelectorAll(`.user-card[data-parent="${parentCard.id}"]`);
            const childNumber = existingChildren.length + 1;
            
            if (existingChildren.length >= 3) {
                console.log('‚ùå –ú–∞–∫—Å–∏–º—É–º 3 –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–∞ —É–∂–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Ä–æ–¥–∏—Ç–µ–ª—è
            const parentRect = parentCard.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const parentX = parentRect.left - containerRect.left;
            const parentY = parentRect.top - containerRect.top;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–æ–≤–æ–≥–æ –¥–æ—á–µ—Ä–Ω–µ–≥–æ —É–∑–ª–∞ —É—Ä–æ–≤–Ω—è 0*
            const childX = parentX + 200; // –°–º–µ—â–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ –Ω–∞ 200px
            
            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—è (—É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ 4 —Ä–∞–∑–∞)
            let childY;
            if (childNumber === 1) {
                childY = parentY - 120; // –ü–µ—Ä–≤—ã–π —É–∑–µ–ª –≤—ã—à–µ —Ä–æ–¥–∏—Ç–µ–ª—è (–±—ã–ª–æ -36, —Å—Ç–∞–ª–æ -120)
            } else if (childNumber === 2) {
                childY = parentY; // –í—Ç–æ—Ä–æ–π —É–∑–µ–ª –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–æ–¥–∏—Ç–µ–ª—è
            } else if (childNumber === 3) {
                childY = parentY + 120; // –¢—Ä–µ—Ç–∏–π —É–∑–µ–ª –Ω–∏–∂–µ —Ä–æ–¥–∏—Ç–µ–ª—è (–±—ã–ª–æ +36, —Å—Ç–∞–ª–æ +120)
            }
            
            // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞
            const uniqueId = generateUniqueId();
            const newChildId = `${childLevel}-dynamic-${uniqueId}`;
            const newChildName = `${childLevel}*/${childNumber}`;
            const humanName = generateHumanName();
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —É–∑–µ–ª
            const newChild = createNode(newChildId, newChildName, childLevel, { x: childX, y: childY }, { humanName, uniqueId });
            newChild.setAttribute('data-parent', parentCard.id);
            newChild.setAttribute('data-human-name', humanName);
            
            container.appendChild(newChild);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–µ–ª–µ–Ω—ã–µ —Ç–æ—á–∫–∏ –∫ –Ω–æ–≤–æ–º—É —É–∑–ª—É
            setTimeout(() => {
                addGreenPointsToAll();
                console.log(`üü¢ –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–µ–ª–µ–Ω—ã–µ —Ç–æ—á–∫–∏ –∫ –Ω–æ–≤–æ–º—É —É–∑–ª—É: ${newChildName}`);
            }, 50);
            
            // –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑—å –º–µ–∂–¥—É —Ä–æ–¥–∏—Ç–µ–ª–µ–º –∏ –Ω–æ–≤—ã–º –¥–æ—á–µ—Ä–Ω–∏–º —É–∑–ª–æ–º
            setTimeout(() => {
                createSingleConnection(parentCard, newChild);
                updateStats();
                console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª: ${newChildName} –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è ${parentCard.id}`);
                
                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                newChild.style.animation = 'fadeIn 0.5s ease-in';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø–æ–≤—ã—à–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —É —Ä–æ–¥–∏—Ç–µ–ª—è —É–∂–µ –µ—Å—Ç—å 3 –ø–∞—Ä—Ç–Ω–µ—Ä–∞ 0*
                const zeroLevelCount = countPartnersAtLevel(targetParent, 0);
                if (zeroLevelCount >= 3) {
                    checkAndUpgradeLevel(targetParent);
                }
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤, —á—Ç–æ–±—ã —Å—Ä–∞–±–æ—Ç–∞–ª–∏ –∫–∞—Å–∫–∞–¥–Ω—ã–µ –ø–æ–≤—ã—à–µ–Ω–∏—è
                checkAllPartners();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                const statusElement = document.getElementById('statusMessage');
                if (statusElement) {
                    statusElement.textContent = `‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —É–∑–µ–ª ${newChildName}! –í—Å–µ–≥–æ —É–∑–ª–æ–≤: ${document.querySelectorAll('.user-card').length}`;
                }
            }, 100);
        }
        
        function createNode(id, name, level, position, options) {
            const { x, y } = position;
            const node = document.createElement('div');
            node.className = 'user-card';
            node.id = id;
            node.setAttribute('data-level', level);
            node.style.left = x + 'px';
            node.style.top = y + 'px';
            
            // –ò–º—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º–æ–µ (–µ—Å–ª–∏ –µ—Å—Ç—å), –∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä ‚Äî –Ω–∏–∂–µ
            const humanName = options && options.humanName ? options.humanName : (node.getAttribute('data-human-name') || '');
            const uniqueId = options && options.uniqueId ? options.uniqueId : '';
            if (uniqueId) node.setAttribute('data-uid', uniqueId);
            const levelPrefix = `${level}*`;
            node.innerHTML = `
                <div class="user-name">${humanName ? humanName : name}</div>
                <div class="user-id">${levelPrefix}${uniqueId ? ' ' + uniqueId : ''}</div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º connection points (–∫—Ä—É–∂–æ—á–∫–∏ –¥–ª—è —Å–≤—è–∑–µ–π)
            const leftConnectionPoint = document.createElement('div');
            leftConnectionPoint.className = 'connection-point left';
            node.appendChild(leftConnectionPoint);
            
            const rightConnectionPoint = document.createElement('div');
            rightConnectionPoint.className = 'connection-point right';
            rightConnectionPoint.title = '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π —É–∑–µ–ª (–º–∞–∫—Å. 3)';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ—á–µ—Ä–Ω–µ–≥–æ —É–∑–ª–∞
            rightConnectionPoint.addEventListener('click', function(e) {
                e.stopPropagation(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è
                console.log('üñ±Ô∏è –ö–ª–∏–∫ –ø–æ –∑–µ–ª–µ–Ω–æ–π —Ç–æ—á–∫–µ –∫–∞—Ä—Ç–æ—á–∫–∏:', node.id);
                addChildNode(node);
            });
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            rightConnectionPoint.addEventListener('mouseenter', function() {
                console.log('üü¢ –ù–∞–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –∑–µ–ª–µ–Ω—É—é —Ç–æ—á–∫—É –∫–∞—Ä—Ç–æ—á–∫–∏:', node.id);
            });
            
            node.appendChild(rightConnectionPoint);
            
            if (id === 'plazma') {
                node.classList.add('root');
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–Ω–∏–π –∫—Ä—É–∂–æ–∫ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
                const expandCircle = document.createElement('div');
                expandCircle.className = 'expand-circle';
                node.appendChild(expandCircle);
            }
            
                   mindMapNodes.push({ id, name, level, x, y });
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤
            let isDragging = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            let dragStartX, dragStartY;
            
            node.addEventListener('mousedown', function(e) {
                // –ù–µ –Ω–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ connection point
                if (e.target.classList.contains('connection-point')) {
                    return;
                }
                
                // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –±—ã–ª–æ –ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                isDragging = false;
                
                // –ß–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞—á–∞–ª–æ—Å—å –ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
                setTimeout(() => {
                    if (!isDragging && Math.abs(e.clientX - dragStartX) < 5 && Math.abs(e.clientY - dragStartY) < 5) {
                        // –ï—Å–ª–∏ –Ω–µ –±—ã–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è, —Å–æ–∑–¥–∞–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞
                        addPartnerToCard(node);
                    }
                }, 200); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            });
            
            node.addEventListener('mousemove', function(e) {
                // –ï—Å–ª–∏ –º—ã—à—å –¥–≤–∏–≥–∞–µ—Ç—Å—è, –∑–Ω–∞—á–∏—Ç –∏–¥–µ—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
                if (Math.abs(e.clientX - dragStartX) > 5 || Math.abs(e.clientY - dragStartY) > 5) {
                    isDragging = true;
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º drag & drop —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
            makeDraggable(node);
            
            return node;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è drag & drop —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
        function makeDraggable(element) {
            let isDragging = false;
            let startX, startY, initialX, initialY;
            
            element.addEventListener('mousedown', function(e) {
                // –ù–µ –Ω–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ connection point
                if (e.target.classList.contains('connection-point')) {
                    return;
                }
                
                isDragging = true;
                element.classList.add('dragging');
                
                startX = e.clientX;
                startY = e.clientY;
                initialX = parseInt(element.style.left) || 0;
                initialY = parseInt(element.style.top) || 0;
                
                console.log(`üñ±Ô∏è –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏: ${element.id}`);
                
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                const newX = initialX + deltaX;
                const newY = initialY + deltaY;
                
                element.style.left = newX + 'px';
                element.style.top = newY + 'px';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–ª–∏–∑–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
                checkCollisions(element);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤—è–∑–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                updateConnectionsForCard(element);
            });
            
            document.addEventListener('mouseup', function(e) {
                if (!isDragging) return;
                
                isDragging = false;
                element.classList.remove('dragging');
                
                console.log(`‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏: ${element.id}`);
                
                // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–∏–∑–∏–π –∏ –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ
                resolveCollisions(element);
                
                // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–≤—è–∑–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                setTimeout(() => {
                    console.log(`üîó –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–≤—è–∑–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è: ${element.id}`);
                    rebuildConnections();
                }, 100);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–ª–ª–∏–∑–∏–π
        function checkCollisions(draggedElement) {
            const allCards = document.querySelectorAll('.user-card');
            const draggedRect = draggedElement.getBoundingClientRect();
            
            allCards.forEach(card => {
                if (card === draggedElement) return;
                
                const cardRect = card.getBoundingClientRect();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ
                const isColliding = !(
                    draggedRect.right < cardRect.left ||
                    draggedRect.left > cardRect.right ||
                    draggedRect.bottom < cardRect.top ||
                    draggedRect.top > cardRect.bottom
                );
                
                if (isColliding) {
                    card.classList.add('collision');
                    draggedElement.classList.add('collision');
                } else {
                    card.classList.remove('collision');
                }
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–ª–ª–∏–∑–∏–π (–æ—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ)
        function resolveCollisions(draggedElement) {
            const allCards = Array.from(document.querySelectorAll('.user-card'));
            const container = document.getElementById('mindmapContainer');
            const containerRect = container.getBoundingClientRect();

            if (!draggedElement) {
                // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤–µ–¥–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫
                for (let i = 0; i < allCards.length; i++) {
                    for (let j = i + 1; j < allCards.length; j++) {
                        const a = allCards[i];
                        const b = allCards[j];
                        const aRect = a.getBoundingClientRect();
                        const bRect = b.getBoundingClientRect();

                        const isColliding = !(
                            aRect.right < bRect.left ||
                            aRect.left > bRect.right ||
                            aRect.bottom < bRect.top ||
                            aRect.top > bRect.bottom
                        );
                        if (!isColliding) continue;

                        const aCenterX = aRect.left + aRect.width / 2;
                        const aCenterY = aRect.top + aRect.height / 2;
                        const bCenterX = bRect.left + bRect.width / 2;
                        const bCenterY = bRect.top + bRect.height / 2;

                        const deltaX = aCenterX - bCenterX;
                        const deltaY = aCenterY - bCenterY;
                        const minDistance = 150;
                        const currentDistance = Math.max(1, Math.sqrt(deltaX * deltaX + deltaY * deltaY));
                        if (currentDistance >= minDistance) continue;

                        const nx = deltaX / currentDistance;
                        const ny = deltaY / currentDistance;
                        const push = (minDistance - currentDistance) / 2;

                        const aX = parseInt(a.style.left) || 0;
                        const aY = parseInt(a.style.top) || 0;
                        const bX = parseInt(b.style.left) || 0;
                        const bY = parseInt(b.style.top) || 0;

                        a.style.left = (aX + nx * push) + 'px';
                        a.style.top = (aY + ny * push) + 'px';
                        b.style.left = (bX - nx * push) + 'px';
                        b.style.top = (bY - ny * push) + 'px';
                    }
                }
                return;
            }

            // –†–µ–∂–∏–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            allCards.forEach(card => {
                if (card === draggedElement) return;

                const draggedRect = draggedElement.getBoundingClientRect();
                const cardRect = card.getBoundingClientRect();

                const isColliding = !(
                    draggedRect.right < cardRect.left ||
                    draggedRect.left > cardRect.right ||
                    draggedRect.bottom < cardRect.top ||
                    draggedRect.top > cardRect.bottom
                );

                if (!isColliding) return;

                const draggedCenterX = draggedRect.left + draggedRect.width / 2;
                const draggedCenterY = draggedRect.top + draggedRect.height / 2;
                const cardCenterX = cardRect.left + cardRect.width / 2;
                const cardCenterY = cardRect.top + cardRect.height / 2;

                const deltaX = draggedCenterX - cardCenterX;
                const deltaY = draggedCenterY - cardCenterY;
                const minDistance = 150;
                const currentDistance = Math.max(1, Math.sqrt(deltaX * deltaX + deltaY * deltaY));

                if (currentDistance >= minDistance) return;

                const nx = deltaX / currentDistance;
                const ny = deltaY / currentDistance;
                const push = (minDistance - currentDistance) / 2;

                const draggedCurrentX = parseInt(draggedElement.style.left) || 0;
                const draggedCurrentY = parseInt(draggedElement.style.top) || 0;
                const cardCurrentX = parseInt(card.style.left) || 0;
                const cardCurrentY = parseInt(card.style.top) || 0;

                draggedElement.style.left = (draggedCurrentX + nx * push) + 'px';
                draggedElement.style.top = (draggedCurrentY + ny * push) + 'px';
                card.style.left = (cardCurrentX - nx * push) + 'px';
                card.style.top = (cardCurrentY - ny * push) + 'px';
            });

            draggedElement.classList.remove('collision');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function updateConnectionsForCard(card) {
            // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤—è–∑–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            // –î–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Å–µ —Å–≤—è–∑–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏
            // –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ü–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        function enableBackgroundPanning() {
            console.log('üñ±Ô∏è –í–∫–ª—é—á–∞–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å + –≤–µ—Ä—Ç–∏–∫–∞–ª—å)...');
            
            const container = document.querySelector('.structure-container');
            let isPanning = false;
            let startX, startY, scrollLeft, scrollTop;
            
            container.addEventListener('mousedown', function(e) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫–Ω—É–ª–∏ –∏–º–µ–Ω–Ω–æ –Ω–∞ —Ñ–æ–Ω, –∞ –Ω–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
                if (e.target.classList.contains('user-card') || 
                    e.target.closest('.user-card') || 
                    e.target.classList.contains('connection-point') ||
                    e.target.tagName === 'path' ||
                    e.target.tagName === 'svg') {
                    return;
                }
                
                isPanning = true;
                container.style.cursor = 'grabbing';
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º clientX/clientY –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                startX = e.clientX;
                startY = e.clientY;
                scrollLeft = container.scrollLeft;
                scrollTop = container.scrollTop;
                
                console.log(`üñ±Ô∏è –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –æ—Ç –ø–æ–∑–∏—Ü–∏–∏: ${startX}, ${startY}`);
                console.log(`üìç –¢–µ–∫—É—â–∏–π —Å–∫—Ä–æ–ª–ª: left=${scrollLeft}, top=${scrollTop}`);
                e.preventDefault();
            });
            
            container.addEventListener('mouseleave', function() {
                if (isPanning) {
                    isPanning = false;
                    container.style.cursor = 'grab';
                    console.log('üñ±Ô∏è –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ (–º—ã—à—å –ø–æ–∫–∏–Ω—É–ª–∞ –æ–±–ª–∞—Å—Ç—å)');
                }
            });
            
            container.addEventListener('mouseup', function() {
                if (isPanning) {
                    isPanning = false;
                    container.style.cursor = 'grab';
                    console.log('‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–æ–Ω–∞');
                }
            });
            
            container.addEventListener('mousemove', function(e) {
                if (!isPanning) return;
                e.preventDefault();
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ –∫ —Å–∫—Ä–æ–ª–ª—É (–∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
                const newScrollLeft = scrollLeft - deltaX;
                const newScrollTop = scrollTop - deltaY;
                
                container.scrollLeft = newScrollLeft;
                container.scrollTop = newScrollTop;
                
                // –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (—Ç–æ–ª—å–∫–æ –∫–∞–∂–¥—ã–µ 10 –ø–∏–∫—Å–µ–ª–µ–π –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
                if (Math.abs(deltaX) % 10 < 2 || Math.abs(deltaY) % 10 < 2) {
                    console.log(`üîÑ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ: deltaX=${deltaX}, deltaY=${deltaY}, scrollLeft=${newScrollLeft}, scrollTop=${newScrollTop}`);
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∫—É—Ä—Å–æ—Ä–∞
            container.style.cursor = 'grab';
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç —Å–∫—Ä–æ–ª–ª–∏—Ç—å—Å—è
            container.style.overflow = 'auto';
            
            console.log('‚úÖ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ —Ñ–æ–Ω—É –≤–∫–ª—é—á–µ–Ω–æ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å + –≤–µ—Ä—Ç–∏–∫–∞–ª—å)');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            const statusElement = document.getElementById('statusMessage');
            if (statusElement) {
                statusElement.textContent = 'üñ±Ô∏è –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ —Ñ–æ–Ω—É –≤–∫–ª—é—á–µ–Ω–æ! –¢—è–Ω–∏—Ç–µ —Ñ–æ–Ω –º—ã—à—å—é –≤ –ª—é–±–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–≥–Ω—É—Ç–æ–π —Å–≤—è–∑–∏
        function createCurvedConnection(fromId, toId, fromX, fromY, toX, toY) {
            const svg = document.getElementById('connectionSvg');
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            
            // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –∫—Ä–∏–≤–æ–π –ë–µ–∑—å–µ
            const controlPoint1X = fromX + (toX - fromX) * 0.5;
            const controlPoint1Y = fromY;
            const controlPoint2X = fromX + (toX - fromX) * 0.5;
            const controlPoint2Y = toY;
            
            const pathData = `M ${fromX} ${fromY} C ${controlPoint1X} ${controlPoint1Y}, ${controlPoint2X} ${controlPoint2Y}, ${toX} ${toY}`;
            
            path.setAttribute('d', pathData);
            path.setAttribute('stroke', '#3B82F6');
            path.setAttribute('stroke-width', '2');
            path.setAttribute('fill', 'none');
            path.setAttribute('opacity', '0.8');
            
            svg.appendChild(path);
            
                   mindMapConnections.push({ fromId, toId, fromX, fromY, toX, toY });
            return path;
        }
        
        function linkNodesById(parentId, childId) {
            const parentEl = document.getElementById(parentId);
            const childEl = document.getElementById(childId);
            if (!parentEl || !childEl) return;
            
            const fromX = parentEl.offsetLeft + parentEl.offsetWidth;
            const fromY = parentEl.offsetTop + parentEl.offsetHeight / 2;
            const toX = childEl.offsetLeft;
            const toY = childEl.offsetTop + childEl.offsetHeight / 2;
            createCurvedConnection(parentId, childId, fromX, fromY, toX, toY);
        }
        
        function computeLayout(root) {
            const nodes = [];
            let maxDepth = 0;
            
            function assign(node, depth = 0, startUnit = 0) {
                maxDepth = Math.max(maxDepth, depth);
                const children = node.children || [];
                node._depth = depth;
                
                if (!children.length) {
                    node._leafCount = 1;
                    node._unitCenter = startUnit + 0.5;
                    nodes.push(node);
                    return startUnit + 1;
                }
                
                let cursor = startUnit;
                children.forEach(child => {
                    cursor = assign(child, depth + 1, cursor);
                });
                
                node._leafCount = cursor - startUnit;
                const first = children[0];
                const last = children[children.length - 1];
                node._unitCenter = (first._unitCenter + last._unitCenter) / 2;
                nodes.push(node);
                return cursor;
            }
            
            const totalLeaves = assign(root, 0, 0);
            const verticalSpacing = CARD_HEIGHT + ROW_GAP;
            const horizontalSpacing = CARD_WIDTH + COLUMN_GAP;
            
            const positions = {};
            nodes.forEach(node => {
                positions[node.id] = {
                    x: BASE_LEFT + node._depth * horizontalSpacing,
                    y: BASE_TOP + (node._unitCenter - 0.5) * verticalSpacing
                };
            });
            
            const canvasHeight = BASE_TOP * 2 + (totalLeaves || 1) * verticalSpacing + CARD_HEIGHT;
            const canvasWidth = BASE_LEFT * 2 + (maxDepth + 1) * horizontalSpacing + CARD_WIDTH;
            
            return { positions, canvasHeight, canvasWidth };
        }
        
        function renderConnectionsFromDom() {
            const svg = document.getElementById('connectionSvg');
            if (!svg) return;
            svg.innerHTML = '';
            mindMapConnections = [];
            
            connectionPairs.forEach(({ parentId, childId }) => {
                linkNodesById(parentId, childId);
            });
        }
        
        function renderMindMap() {
            console.log('üé®üé®üé® –í–´–ó–í–ê–ù–ê –°–¢–ê–†–ê–Ø –§–£–ù–ö–¶–ò–Ø renderMindMap() üé®üé®üé®');
            console.log('üé® Rendering horizontal mind map...');
            
            const container = document.getElementById('mindmapContainer');
            const svg = document.getElementById('connectionSvg');
            
            if (!container || !svg) {
                console.error('Container or SVG not found!');
                return;
            }
            
            // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ SVG, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º —Å–∞–º —ç–ª–µ–º–µ–Ω—Ç
            svg.innerHTML = '';
                   mindMapNodes = [];
                   mindMapConnections = [];
            connectionPairs = [];
            
            const existingNodes = container.querySelectorAll('.user-card');
            existingNodes.forEach(node => node.remove());
            
            currentLayout = computeLayout(mindMapStructure);
            const { positions, canvasHeight, canvasWidth } = currentLayout;
            container.style.height = `${canvasHeight}px`;
            container.style.width = `${canvasWidth}px`;
            
            function renderNodeRecursive(nodeData, parentId = null) {
                const position = positions[nodeData.id];
                if (!position) return;
                
                const nodeEl = createNode(nodeData.id, nodeData.name, nodeData.level, position);
                container.appendChild(nodeEl);
                
                if (parentId) {
                    connectionPairs.push({ parentId, childId: nodeData.id });
                }
                
                (nodeData.children || []).forEach(child => renderNodeRecursive(child, nodeData.id));
            }
            
            renderNodeRecursive(mindMapStructure, null);
            // renderConnectionsFromDom(); // –û–¢–ö–õ–Æ–ß–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º rebuildConnections –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π MLM –ª–æ–≥–∏–∫–∏
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Å–≤—è–∑–µ–π —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π MLM –ª–æ–≥–∏–∫–æ–π
            setTimeout(() => {
                rebuildConnections();
            }, 100);
            
            updateStats();
            console.log('‚úÖ Horizontal mind map rendered successfully!');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π MLM —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º —Ä–æ—Å—Ç–æ–º 1‚Üí3‚Üí9‚Üí27‚Üí81
        function generateIndividualStructures() {
            console.log('üèóÔ∏èüèóÔ∏èüèóÔ∏è –í–´–ó–í–ê–ù–ê –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø generateIndividualStructures() üèóÔ∏èüèóÔ∏èüèóÔ∏è');
            console.log('üèóÔ∏è –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é MLM —Å—Ç—Ä—É–∫—Ç—É—Ä—É: 4=1 ‚Üí 3=3 ‚Üí 2=9 ‚Üí 1=27 ‚Üí 0=81...');
            
            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            const container = document.getElementById('mindmapContainer');
            if (!container) {
                console.error('‚ùå mindmapContainer –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            const existingCards = container.querySelectorAll('.user-card');
            console.log(`üóëÔ∏è –£–¥–∞–ª—è–µ–º ${existingCards.length} —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫`);
            existingCards.forEach(card => card.remove());
            
            // –°–æ–∑–¥–∞–µ–º MLM —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
            
            // PLAZMA —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–¥–∞–ª–µ–Ω–∞ - –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ IVA
            console.log('‚ÑπÔ∏è PLAZMA —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞ - —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å IVA');
            
            console.log(`‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞! –í—Å–µ–≥–æ –∫–∞—Ä—Ç–æ—á–µ–∫: 0`);
            console.log('üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞: IVA –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ');
            updateStats();
            
            // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–≤—è–∑–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏—Ö
            setTimeout(() => {
                rebuildConnections();
                setTimeout(() => {
                    checkAndRedrawConnections();
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –∑–µ–ª–µ–Ω—ã–µ —Ç–æ—á–∫–∏ –∫–æ –≤—Å–µ–º —É–∑–ª–∞–º
                    addGreenPointsToAll();
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º IVA –∫–∞–∫ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ Level 0*
                    console.log('üîÑ –í—ã–∑—ã–≤–∞–µ–º addIVAPartner –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏...');
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º setTimeout –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —á—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∏ –≥–æ—Ç–æ–≤—ã
                    setTimeout(() => {
                        console.log('‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—à–ª–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏–∑ –ë–î...');
                        loadAndDisplayPartners();
                    }, 100);
                }, 200);
            }, 100);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è 0 –°–ò–ú–ú–ï–¢–†–ò–ß–ù–û –í–í–ï–†–• –ò –í–ù–ò–ó (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)
        function addLevel0() {
            console.log('‚ûï –î–æ–±–∞–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å 0 –°–ò–ú–ú–ï–¢–†–ò–ß–ù–û –í–í–ï–†–• –ò –í–ù–ò–ó...');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å 0 –ø–æ–¥ –∫–∞–∂–¥—ã–π —É–∑–µ–ª —É—Ä–æ–≤–Ω—è 1
            const level1Nodes = document.querySelectorAll('.user-card[data-level="1"]');
            const mindmapRect = document.getElementById('mindmapContainer').getBoundingClientRect();
            level1Nodes.forEach((node, index) => {
                const nodeRect = node.getBoundingClientRect();
                const nodeX = nodeRect.left - mindmapRect.left;
                const nodeY = nodeRect.top - mindmapRect.top;
                
                // –°–æ–∑–¥–∞–µ–º 3 —É–∑–ª–∞ —É—Ä–æ–≤–Ω—è 0 –ø–æ–¥ –∫–∞–∂–¥—ã–º —É–∑–ª–æ–º —É—Ä–æ–≤–Ω—è 1 –°–ò–ú–ú–ï–¢–†–ò–ß–ù–û
                for (let i = 0; i < 3; i++) {
                    const level0X = nodeX + 300; // –ë–ª–∏–∂–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
                    // –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: –æ–¥–∏–Ω –≤ —Ü–µ–Ω—Ç—Ä–µ, –¥–≤–∞ –ø–æ –±–æ–∫–∞–º
                    let level0Y;
                    if (i === 0) {
                        level0Y = nodeY - 40; // –í–µ—Ä—Ö–Ω–∏–π
                    } else if (i === 1) {
                        level0Y = nodeY + 20; // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π
                    } else {
                        level0Y = nodeY + 80; // –ù–∏–∂–Ω–∏–π
                    }
                    
                    const newId = `0-${index * 3 + i + 1}`;
                    const level0Node = createNode(newId, `0*/${index * 3 + i + 1}`, 0, { x: level0X, y: level0Y });
                    document.getElementById('mindmapContainer').appendChild(level0Node);
                    
                    // –ù–ï —Å–æ–∑–¥–∞–µ–º —Å–≤—è–∑–∏ –∑–¥–µ—Å—å - –æ–Ω–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –≤ rebuildConnections() —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π MLM –ª–æ–≥–∏–∫–æ–π
                }
            });
            
            updateStats();
            console.log('‚úÖ –£—Ä–æ–≤–µ–Ω—å 0 –¥–æ–±–∞–≤–ª–µ–Ω –°–ò–ú–ú–ï–¢–†–ò–ß–ù–û –í–í–ï–†–• –ò –í–ù–ò–ó!');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Level 0
            setTimeout(() => {
                fixOverlaps();
            }, 100);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const level0Count = document.querySelectorAll('.user-card[data-level="0"]').length;
            const level1Count = document.querySelectorAll('.user-card[data-level="1"]').length;
            const level2Count = document.querySelectorAll('.user-card[data-level="2"]').length;
            const level3Count = document.querySelectorAll('.user-card[data-level="3"]').length;
            const totalNodes = document.querySelectorAll('.user-card').length;
            const totalConnections = document.querySelectorAll('path').length;
            
            document.getElementById('level0Count').textContent = level0Count;
            document.getElementById('level1Count').textContent = level1Count;
            document.getElementById('level2Count').textContent = level2Count;
            document.getElementById('level3Count').textContent = level3Count;
            document.getElementById('totalNodes').textContent = totalNodes;
            document.getElementById('totalConnections').textContent = totalConnections;
            
            document.getElementById('statusMessage').textContent = 
                `‚úÖ –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–ê–Ø –ú–ê–ô–ù–î-–ö–ê–†–¢–ê v19 –≥–æ—Ç–æ–≤–∞! –£–∑–ª–æ–≤: ${totalNodes}, –°–≤—è–∑–µ–π: ${totalConnections}`;
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function clearMindMap() {
            const svg = document.getElementById('connectionSvg');
            const container = document.getElementById('mindmapContainer');
            
            if (svg) svg.innerHTML = '';
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —É–∑–ª—ã –∫—Ä–æ–º–µ SVG
            const nodes = container.querySelectorAll('.user-card');
            nodes.forEach(node => node.remove());
            
                   mindMapNodes = [];
                   mindMapConnections = [];
            connectionPairs = [];
            updateStats();
        }
        
        function testConnections() {
            console.log('üîó –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–∑–æ–≥–Ω—É—Ç—ã–µ —Å–≤—è–∑–∏...');
            const paths = document.querySelectorAll('path');
            paths.forEach((path, index) => {
                setTimeout(() => {
                    path.setAttribute('stroke', '#EF4444');
                    setTimeout(() => {
                        path.setAttribute('stroke', '#3B82F6');
                    }, 200);
                }, index * 100);
            });
        }
        
        function showFullStructure() {
            renderMindMap();
            setTimeout(() => {
                addLevel0();
            }, 500);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π –¢–û–õ–¨–ö–û –¥–ª—è 0-–≥–æ —É—Ä–æ–≤–Ω—è (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫—Ä–∞—Å–∏–≤–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ 1-3 —É—Ä–æ–≤–Ω–µ–π)
        function fixOverlaps() {
            console.log('üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è 0-–≥–æ —É—Ä–æ–≤–Ω—è —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ PLAZMA...');
            
            const level0Cards = document.querySelectorAll('.user-card[data-level="0"]');
            const plazmaCard = document.querySelector('.user-card[data-level="4"]');
            const cardWidth = 120;
            const cardHeight = 60;
            const minSpacing = 3;
            
            let totalFixed = 0;
            
            if (level0Cards.length > 0) {
                console.log(`üîß –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º 0-–π —É—Ä–æ–≤–µ–Ω—å: ${level0Cards.length} –∫–∞—Ä—Ç–æ—á–µ–∫`);
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é PLAZMA –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
                let plazmaY = 700; // –£–≤–µ–ª–∏—á–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –Ω–æ–≤–æ–≥–æ padding 400px
                if (plazmaCard) {
                    const plazmaRect = plazmaCard.getBoundingClientRect();
                    const containerRect = document.getElementById('mindmapContainer').getBoundingClientRect();
                    plazmaY = plazmaRect.top - containerRect.top + plazmaRect.height / 2;
                    console.log(`üéØ PLAZMA –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ Y: ${plazmaY}`);
                }
                
                // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â—É—é –≤—ã—Å–æ—Ç—É –±–ª–æ–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ 0-–≥–æ —É—Ä–æ–≤–Ω—è
                const totalHeight = level0Cards.length * (cardHeight + minSpacing) - minSpacing;
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ PLAZMA —Å —É—á–µ—Ç–æ–º padding
                const startY = Math.max(100, plazmaY - (totalHeight / 2)); // –ú–∏–Ω–∏–º—É–º 100px –æ—Ç –≤–µ—Ä—Ö–∞
                const baseX = 1500; // –£–≤–µ–ª–∏—á–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏—è —Å–ø—Ä–∞–≤–∞ –æ—Ç —É—Ä–æ–≤–Ω—è 1 —Å —É—á–µ—Ç–æ–º padding
                const spacingY = cardHeight + minSpacing;
                
                console.log(`üéØ –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ 0-–≥–æ —É—Ä–æ–≤–Ω—è: startY=${startY}, totalHeight=${totalHeight}, plazmaY=${plazmaY}`);
                
                level0Cards.forEach((card, index) => {
                    const targetX = baseX;
                    const targetY = startY + (index * spacingY);
                    
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é
                    const currentX = parseInt(card.style.left) || 0;
                    const currentY = parseInt(card.style.top) || 0;
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
                    card.style.left = `${targetX}px`;
                    card.style.top = `${targetY}px`;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏—è
                    if (Math.abs(currentX - targetX) > 5 || Math.abs(currentY - targetY) > 5) {
                        totalFixed++;
                        console.log(`üîß –ü–µ—Ä–µ–º–µ—â–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ 0-–≥–æ —É—Ä–æ–≤–Ω—è ${card.id}: ${currentX},${currentY} ‚Üí ${targetX},${targetY}`);
                    }
                });
            }
            
            console.log(`‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π –¥–ª—è 0-–≥–æ —É—Ä–æ–≤–Ω—è: ${totalFixed}`);
            
            // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Å–µ —Å–≤—è–∑–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π
            setTimeout(() => {
                rebuildConnections();
            }, 100);
            
            updateStats();
            
            return {
                success: true,
                totalFixed: totalFixed,
                message: `üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ${totalFixed} –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π –¥–ª—è 0-–≥–æ —É—Ä–æ–≤–Ω—è! –£—Ä–æ–≤–Ω–∏ 1-3 —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.`
            };
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–æ–¥—Å—á–µ—Ç–∞ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π
        function checkOverlaps() {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫...');
            
            const allCards = document.querySelectorAll('.user-card');
            const cardWidth = 120;
            const cardHeight = 60;
            const minSpacing = 3;
            
            let overlaps = 0;
            const overlapPairs = [];
            
            for (let i = 0; i < allCards.length; i++) {
                for (let j = i + 1; j < allCards.length; j++) {
                    const card1 = allCards[i];
                    const card2 = allCards[j];
                    
                    const x1 = parseInt(card1.style.left) || 0;
                    const y1 = parseInt(card1.style.top) || 0;
                    const x2 = parseInt(card2.style.left) || 0;
                    const y2 = parseInt(card2.style.top) || 0;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ
                    const overlapX = Math.abs(x1 - x2) < cardWidth + minSpacing;
                    const overlapY = Math.abs(y1 - y2) < cardHeight + minSpacing;
                    
                    if (overlapX && overlapY) {
                        overlaps++;
                        if (overlapPairs.length < 5) { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 5
                            overlapPairs.push({
                                card1: card1.id,
                                card2: card2.id,
                                pos1: { x: x1, y: y1 },
                                pos2: { x: x2, y: y2 }
                            });
                        }
                    }
                }
            }
            
            console.log(`üîç –ù–∞–π–¥–µ–Ω–æ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π: ${overlaps}`);
            if (overlapPairs.length > 0) {
                console.log('üîç –ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π:', overlapPairs);
            }
            
            return {
                totalOverlaps: overlaps,
                overlapPairs: overlapPairs,
                success: overlaps === 0,
                message: overlaps === 0 ? 
                    '‚úÖ –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!' : 
                    `‚ùå –ù–∞–π–¥–µ–Ω–æ ${overlaps} –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–π`
            };
        }
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
        let isRebuildingConnections = false;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ —Å–≤—è–∑–µ–π
        function checkAndRedrawConnections() {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º–∏ –∏ –¥–æ—á–µ—Ä–Ω–∏–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏...');
            
            const allCards = document.querySelectorAll('.user-card');
            const cardsByLevel = {};
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º
            allCards.forEach(card => {
                const level = card.getAttribute('data-level');
                if (!cardsByLevel[level]) {
                    cardsByLevel[level] = [];
                }
                cardsByLevel[level].push(card);
            });
            
            let missingConnections = 0;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑–∏ Level 4 ‚Üí Level 3
            if (cardsByLevel['4'] && cardsByLevel['3']) {
                const expectedConnections = cardsByLevel['4'].length * cardsByLevel['3'].length;
                console.log(`üîç –û–∂–∏–¥–∞–µ–º —Å–≤—è–∑–µ–π 4‚Üí3: ${expectedConnections}`);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑–∏ Level 3 ‚Üí Level 2
            if (cardsByLevel['3'] && cardsByLevel['2']) {
                cardsByLevel['3'].forEach((level3Card, index) => {
                    for (let i = 0; i < 3; i++) {
                        const level2Index = index * 3 + i;
                        if (cardsByLevel['2'][level2Index]) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–≤—è–∑—å –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
                            const hasConnection = checkConnectionExists(level3Card, cardsByLevel['2'][level2Index]);
                            if (!hasConnection) {
                                missingConnections++;
                            }
                        }
                    }
                });
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑–∏ Level 2 ‚Üí Level 1
            if (cardsByLevel['2'] && cardsByLevel['1']) {
                cardsByLevel['2'].forEach((level2Card, index) => {
                    for (let i = 0; i < 3; i++) {
                        const level1Index = index * 3 + i;
                        if (cardsByLevel['1'][level1Index]) {
                            const hasConnection = checkConnectionExists(level2Card, cardsByLevel['1'][level1Index]);
                            if (!hasConnection) {
                                missingConnections++;
                            }
                        }
                    }
                });
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑–∏ Level 1 ‚Üí Level 0
            if (cardsByLevel['1'] && cardsByLevel['0']) {
                cardsByLevel['1'].forEach((level1Card, index) => {
                    for (let i = 0; i < 3; i++) {
                        const level0Index = index * 3 + i;
                        if (cardsByLevel['0'][level0Index]) {
                            const hasConnection = checkConnectionExists(level1Card, cardsByLevel['0'][level0Index]);
                            if (!hasConnection) {
                                missingConnections++;
                            }
                        }
                    }
                });
            }
            
            console.log(`üîç –ù–∞–π–¥–µ–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å–≤—è–∑–µ–π: ${missingConnections}`);
            
            if (missingConnections > 0) {
                console.log('üîß –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–≤—è–∑–∏...');
                rebuildConnections();
                return true;
            } else {
                console.log('‚úÖ –í—Å–µ —Å–≤—è–∑–∏ –Ω–∞ –º–µ—Å—Ç–µ!');
                return false;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
        function checkConnectionExists(parentCard, childCard) {
            // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –∏—â–µ–º SVG path, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–µ–¥–∏–Ω—è–µ—Ç —ç—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫–∏
            const svg = document.getElementById('connectionsSvg') || document.getElementById('connectionSvg');
            if (!svg) return false;
            
            const parentRect = parentCard.getBoundingClientRect();
            const childRect = childCard.getBoundingClientRect();
            const containerRect = document.getElementById('mindmapContainer').getBoundingClientRect();
            
            const parentX = parentRect.left - containerRect.left + parentRect.width / 2;
            const parentY = parentRect.top - containerRect.top + parentRect.height / 2;
            const childX = childRect.left - containerRect.left + childRect.width / 2;
            const childY = childRect.top - containerRect.top + childRect.height / 2;
            
            // –ò—â–µ–º path, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä—è–¥–æ–º —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Ä—è–¥–æ–º —Å –¥–æ—á–µ—Ä–Ω–µ–π
            const paths = svg.querySelectorAll('path');
            for (let path of paths) {
                const pathData = path.getAttribute('d');
                if (pathData && pathData.includes(`M ${parentX}`) && pathData.includes(`${childX} ${childY}`)) {
                    return true;
                }
            }
            
            return false;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∏ –≤—Å–µ—Ö —Å–≤—è–∑–µ–π —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π –∫–∞—Ä—Ç–æ—á–µ–∫
        function rebuildConnections() {
            if (isRebuildingConnections) {
                console.log('‚è≥ rebuildConnections —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º...');
                return 0;
            }
            
            isRebuildingConnections = true;
            console.log('üîó –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—Å–µ —Å–≤—è–∑–∏ —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π...');
            
            // –ò—â–µ–º SVG —ç–ª–µ–º–µ–Ω—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å connectionSvg –∏–ª–∏ connectionsSvg)
            let svg = document.getElementById('connectionsSvg') || document.getElementById('connectionSvg');
            if (!svg) {
                console.log('‚ùå SVG —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                isRebuildingConnections = false;
                return 0;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã SVG
            const svgRect = svg.getBoundingClientRect();
            console.log(`üìê SVG —Ä–∞–∑–º–µ—Ä—ã: ${svgRect.width}x${svgRect.height}, –ø–æ–∑–∏—Ü–∏—è: ${svgRect.left}, ${svgRect.top}`);
            
            console.log(`üßπ –û—á–∏—â–∞–µ–º SVG (—Ç–µ–∫—É—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${svg.children.length})`);
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–≤—è–∑–µ–π
            while (svg.firstChild) {
                svg.removeChild(svg.firstChild);
            }
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–µ—Å—Ç—Ä —É–∂–µ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π
            window._drawnConnections = new Set();
            
            console.log(`‚úÖ SVG –æ—á–∏—â–µ–Ω (–æ—Å—Ç–∞–ª–æ—Å—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${svg.children.length})`);
            
            let rebuiltConnections = 0;
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–µ–π
            const allCards = document.querySelectorAll('.user-card');
            const cardsByLevel = {};
            
            console.log(`üîç –ù–∞–π–¥–µ–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫: ${allCards.length}`);
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º
            allCards.forEach(card => {
                const level = card.getAttribute('data-level');
                if (!cardsByLevel[level]) {
                    cardsByLevel[level] = [];
                }
                cardsByLevel[level].push(card);
            });
            
            // –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —É—Ä–æ–≤–Ω—è–º
            Object.keys(cardsByLevel).forEach(level => {
                console.log(`üìä Level ${level}: ${cardsByLevel[level].length} –∫–∞—Ä—Ç–æ—á–µ–∫`);
            });
            
            const containerRect = document.getElementById('mindmapContainer').getBoundingClientRect();
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –¥–≤—É–º—è –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
            function createConnection(parentCard, childCard) {
                console.log(`üîó –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑—å: ${parentCard.id} ‚Üí ${childCard.id}`);
                // –ù–µ –¥—É–±–ª–∏—Ä—É–µ–º –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Å–≤—è–∑—å
                if (!window._drawnConnections) window._drawnConnections = new Set();
                const key = parentCard.id + '>' + childCard.id;
                if (window._drawnConnections.has(key)) {
                    console.log('‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥—É–±–ª–∏—Ä—É—é—â—É—é —Å–≤—è–∑—å', key);
                    return;
                }
                window._drawnConnections.add(key);
                const parentRect = parentCard.getBoundingClientRect();
                const childRect = childCard.getBoundingClientRect();
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–∏–µ connection points –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                const parentRightPoint = parentCard.querySelector('.connection-point.right');
                const childLeftPoint = childCard.querySelector('.connection-point.left');
                
                let parentX, parentY, childX, childY;
                
                if (parentRightPoint && childLeftPoint) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º connection points
                    const parentPointRect = parentRightPoint.getBoundingClientRect();
                    const childPointRect = childLeftPoint.getBoundingClientRect();
                    
                    parentX = parentPointRect.left - containerRect.left + parentPointRect.width / 2;
                    parentY = parentPointRect.top - containerRect.top + parentPointRect.height / 2;
                    childX = childPointRect.left - containerRect.left + childPointRect.width / 2;
                    childY = childPointRect.top - containerRect.top + childPointRect.height / 2;
                } else {
                    // Fallback –∫ —Ü–µ–Ω—Ç—Ä—É –∫–∞—Ä—Ç–æ—á–µ–∫ –µ—Å–ª–∏ connection points –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                    parentX = parentRect.left - containerRect.left + parentRect.width / 2;
                    parentY = parentRect.top - containerRect.top + parentRect.height / 2;
                    childX = childRect.left - containerRect.left + childRect.width / 2;
                    childY = childRect.top - containerRect.top + childRect.height / 2;
                }
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                
                // –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –∏–∑–æ–≥–Ω—É—Ç–æ–π –ª–∏–Ω–∏–∏
                const controlX1 = parentX + (childX - parentX) * 0.5;
                const controlY1 = parentY;
                const controlX2 = parentX + (childX - parentX) * 0.5;
                const controlY2 = childY;
                
                const pathData = `M ${parentX} ${parentY} C ${controlX1} ${controlY1}, ${controlX2} ${controlY2}, ${childX} ${childY}`;
                
                path.setAttribute('d', pathData);
                path.setAttribute('stroke', '#3B82F6');
                path.setAttribute('stroke-width', '3'); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ç–æ–ª—â–∏–Ω—É –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
                path.setAttribute('fill', 'none');
                path.setAttribute('opacity', '1'); // –î–µ–ª–∞–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º–∏
                path.setAttribute('class', 'connection-line'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                
                svg.appendChild(path);
                rebuiltConnections++;
                
                console.log(`‚úÖ SVG —Å–≤—è–∑—å –¥–æ–±–∞–≤–ª–µ–Ω–∞: ${pathData}`);
            }
            
            // –ò—Å–∫–ª—é—á–∞–µ–º —É—Ä–æ–≤–µ–Ω—å-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ data-parent
            
            // –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ data-parent –∞—Ç—Ä–∏–±—É—Ç–∞ (—á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤—è–∑–∏)
            allCards.forEach(card => {
                const parentId = card.getAttribute('data-parent');
                if (!parentId) return;
                const parentCard = document.getElementById(parentId);
                if (!parentCard) return;
                createConnection(parentCard, card);
                console.log(`üîó –°–≤—è–∑—å —á–µ—Ä–µ–∑ data-parent: ${parentId} ‚Üí ${card.id}`);
            });
            
            console.log(`‚úÖ –ü–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–æ —Å–≤—è–∑–µ–π: ${rebuiltConnections}`);
            isRebuildingConnections = false;
            return rebuiltConnections;
        }
        
        function centerView() {
            const container = document.querySelector('.structure-container');
            container.scrollLeft = 0;
            container.scrollTop = 0;
            console.log('üéØ –í–∏–¥ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ PLAZMA');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ —Å –±–æ—Ç–æ–º
        function openBotChat() {
            console.log('üí¨ –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å –±–æ—Ç–æ–º...');
            
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —á–∞—Ç–∞ —Å –±–æ—Ç–æ–º
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            const chatWindow = document.createElement('div');
            chatWindow.style.cssText = `
                background: white;
                border-radius: 15px;
                padding: 20px;
                width: 500px;
                height: 600px;
                display: flex;
                flex-direction: column;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            chatWindow.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #333;">üí¨ –ß–∞—Ç —Å –±–æ—Ç–æ–º</h3>
                    <button onclick="this.closest('.modal').remove()" style="
                        background: none;
                        border: none;
                        font-size: 24px;
                        cursor: pointer;
                        color: #666;
                    ">√ó</button>
                </div>
                
                <div id="chatMessages" style="
                    flex: 1;
                    border: 1px solid #ddd;
                    border-radius: 10px;
                    padding: 15px;
                    overflow-y: auto;
                    background: #f9f9f9;
                    margin-bottom: 15px;
                ">
                    <div style="color: #666; text-align: center; margin-top: 50px;">
                        –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram –±–æ—Ç–æ–º<br>
                        <small>–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</small>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="
                        flex: 1;
                        padding: 12px;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        font-size: 14px;
                    ">
                    <button onclick="sendBotMessage()" style="
                        padding: 12px 20px;
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                    ">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            `;
            
            modal.className = 'modal';
            modal.appendChild(chatWindow);
            document.body.appendChild(modal);
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter
                setTimeout(() => {
                const input = document.getElementById('messageInput');
                input.focus();
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendBotMessage();
                    }
                });
            }, 100);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
        function sendBotMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const chatMessages = document.getElementById('chatMessages');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userMessage = document.createElement('div');
            userMessage.style.cssText = `
                margin-bottom: 10px;
                text-align: right;
            `;
            userMessage.innerHTML = `
                <div style="
                    display: inline-block;
                    background: #667eea;
                    color: white;
                    padding: 8px 12px;
                    border-radius: 15px;
                    max-width: 70%;
                    word-wrap: break-word;
                ">${message}</div>
            `;
            chatMessages.appendChild(userMessage);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –±–æ—Ç–∞
                setTimeout(() => {
                const botMessage = document.createElement('div');
                botMessage.style.cssText = `
                    margin-bottom: 10px;
                    text-align: left;
                `;
                botMessage.innerHTML = `
                    <div style="
                        display: inline-block;
                        background: #f0f0f0;
                        color: #333;
                        padding: 8px 12px;
                        border-radius: 15px;
                        max-width: 70%;
                        word-wrap: break-word;
                    ">ü§ñ –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ: "${message}"<br><small>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram –±–æ—Ç–æ–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</small></div>
                `;
                chatMessages.appendChild(botMessage);
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM Content Loaded - PROFILE IVA v61 - –°–û–•–†–ê–ù–ï–ù–ò–ï –í –ë–î!');
            console.log('üîç Debug: DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –º–∞–π–Ω–¥-–∫–∞—Ä—Ç—ã...');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ IVA
            console.log('üëë –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ IVA...');
            setTimeout(() => {
                // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º IVA
                generateIndividualStructures();
            }, 500);
            
            console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–æ—Ç–æ–≤–∞! –ü—Ä–æ—Ñ–∏–ª—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ IVA –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
        });
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–Ω–æ–ø–∫–∞–º–∏
    </script>
</body>
</html>
