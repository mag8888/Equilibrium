<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåê MLM –°–¢–†–£–ö–¢–£–†–ê - –ö–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: #1a202c;
            overflow-x: auto;
            overflow-y: auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            gap: 8px;
        }
        
        .search-icon {
            width: 16px;
            height: 16px;
            opacity: 0.8;
        }
        
        .search-input {
            background: none;
            border: none;
            color: white;
            outline: none;
            width: 200px;
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .upgrade-btn {
            background: #fbbf24;
            color: #1a202c;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }
        
        .upgrade-btn:hover {
            background: #f59e0b;
            transform: translateY(-1px);
        }

        .structure-container {
            position: relative;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 50px;
            overflow: auto;
            min-height: 600px;
            min-width: 1200px;
        }

        .node {
            position: absolute;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .node:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-color: #3b82f6;
        }
        
        .node.root {
            background: linear-gradient(145deg, #8b5cf6, #7c3aed);
            color: white;
            border-color: #7c3aed;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .node.root:hover {
            transform: scale(1.05);
        }

        .node-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: #1a202c;
            margin-bottom: 2px;
        }
        
        .node.root .node-name {
            color: white;
        }
        
        .node-level {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .node.root .node-level {
            color: rgba(255, 255, 255, 0.8);
        }

        /* –°–∏–Ω–∏–µ –∫—Ä—É–∂–∫–∏ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è */
        .expand-circle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            z-index: 15;
            transition: all 0.3s ease;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .expand-circle:hover {
            background: #2563eb;
            transform: scale(1.2);
        }
        
        .expand-circle.collapsed {
            background: #94a3b8;
        }
        
        .expand-circle.collapsed:hover {
            background: #64748b;
        }

        /* Target –∏–∫–æ–Ω–∫–∏ –¥–ª—è —Å–≤–µ—Ä–Ω—É—Ç—ã—Ö —É–∑–ª–æ–≤ */
        .target-icon {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            z-index: 15;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .target-icon::before {
            content: '';
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
        }
        
        .target-icon:hover {
            background: #2563eb;
            transform: scale(1.2);
        }

        .connection-line {
            position: absolute;
            stroke: #3b82f6;
            stroke-width: 2;
            fill: none;
            z-index: 5;
            opacity: 0;
            animation: fadeInLine 0.8s forwards;
        }

        @keyframes fadeInLine {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .expand-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: #374151;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .expand-btn:hover {
            background: #1f2937;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        /* Chat bubble –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞ */
        .chat-bubble {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            .title {
                font-size: 1.5rem;
            }
            .structure-container {
                padding: 15px;
                border-radius: 0;
                min-width: 100%;
            }
            .node {
                min-width: 100px;
                padding: 6px 10px;
            }
            .node-name {
                font-size: 0.8rem;
            }
            .node-level {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-section">
            <div class="logo">P</div>
            <h1 class="title">PLAZMA</h1>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6,9 12,15 18,9"></polyline>
            </svg>
        </div>
        <div class="header-controls">
            <div class="search-box">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫...">
            </div>
            <button class="upgrade-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M7 17L17 7"></path>
                    <path d="M7 7h10v10"></path>
                </svg>
                Upgrade
            </button>
        </div>
    </div>

    <div class="structure-container" id="structureContainer">
        <!-- Nodes and connections will be rendered here by JavaScript -->
        <button class="expand-btn" id="expandBtn">Expand</button>
    </div>

    <script>
        const structureContainer = document.getElementById('structureContainer');
        const expandBtn = document.getElementById('expandBtn');

        let nodes = {};
        let connections = {};
        let nodeData = {};
        let expandedNodes = new Set(); // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Ä–∞—Å–∫—Ä—ã—Ç—ã–µ —É–∑–ª—ã

        // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ - –ø–æ 3 –Ω–∞ —É—Ä–æ–≤–µ–Ω—å
        const mlmStructure = {
            id: 'PLAZMA', name: 'PLAZMA', level: 0, expanded: true,
            children: [
                { id: '3-1', name: '3*/1 —é–∑–µ—Ä–Ω–µ–π–º', level: 3, expanded: true,
                    children: [
                        { id: '2-1', name: '2*/1 —é–∑–µ—Ä–Ω–µ–π–º', level: 2, expanded: true,
                            children: [
                                { id: '1-1', name: '1*/1 —é–∑–µ—Ä–Ω–µ–π–º', level: 1, expanded: true,
                                    children: [
                                        { id: '0-1', name: '0*/1 —é–∑–µ—Ä–Ω–µ–π–º', level: 0, expanded: false, children: [] },
                                        { id: '0-2', name: '0*/2 —é–∑–µ—Ä–Ω–µ–π–º', level: 0, expanded: true,
                                            children: [
                                                { id: '0-1-2', name: '0*/1 —é–∑–µ—Ä–Ω–µ–π–º', level: 0, expanded: false, children: [] }
                                            ]
                                        },
                                        { id: '0-3', name: '0*/3 —é–∑–µ—Ä–Ω–µ–π–º', level: 0, expanded: false, children: [] }
                                    ]
                                },
                                { id: '1-2', name: '1*/2 —é–∑–µ—Ä–Ω–µ–π–º', level: 1, expanded: false, children: [] },
                                { id: '1-3', name: '1*/3 —é–∑–µ—Ä–Ω–µ–π–º', level: 1, expanded: false, children: [] }
                            ]
                        },
                        { id: '2-2', name: '2*/2 —é–∑–µ—Ä–Ω–µ–π–º', level: 2, expanded: false, children: [] },
                        { id: '2-3', name: '2*/3 —é–∑–µ—Ä–Ω–µ–π–º', level: 2, expanded: false, children: [] }
                    ]
                }
            ]
        };

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–∑–∏—Ü–∏–π –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ
        function calculateNodePositions(node, level = 0, xOffset = 0, yOffset = 0, parentX = 0, parentY = 0, branchIndex = 0, totalBranches = 1) {
            const nodeWidth = 120;
            const nodeHeight = 60;
            const horizontalSpacing = 200;
            const verticalSpacing = 150;
            const containerPadding = 100;

            let currentX = xOffset;
            let currentY = yOffset + level * verticalSpacing;

            if (level === 0) {
                // –ö–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª –≤–Ω–∏–∑—É —Å–ª–µ–≤–∞ –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ
                currentX = containerPadding;
                currentY = 400; // –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å
            } else {
                // –î–ª—è –¥–æ—á–µ—Ä–Ω–∏—Ö —É–∑–ª–æ–≤ - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ
                const totalWidth = (totalBranches - 1) * horizontalSpacing;
                const startX = parentX - totalWidth / 2;
                currentX = startX + branchIndex * horizontalSpacing;
                
                if (currentX < containerPadding) {
                    currentX = containerPadding;
                }
            }

            node.x = currentX;
            node.y = currentY;

            nodeData[node.id] = { ...node, x: currentX, y: currentY };

            if (node.children && node.children.length > 0 && node.expanded) {
                node.children.forEach((child, i) => {
                    calculateNodePositions(child, level + 1, 0, yOffset, currentX, currentY, i, node.children.length);
                });
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —É–∑–ª–æ–≤
        function renderNode(node) {
            const nodeElement = document.createElement('div');
            nodeElement.className = 'node';
            if (node.level === 0 && node.id === 'PLAZMA') nodeElement.classList.add('root');
            nodeElement.id = `node-${node.id}`;
            nodeElement.style.left = `${node.x}px`;
            nodeElement.style.top = `${node.y}px`;
            nodeElement.innerHTML = `
                <div class="node-name">${node.name}</div>
                <div class="node-level">${node.level}*/${node.id.split('-')[1] || '1'} —é–∑–µ—Ä–Ω–µ–π–º</div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º chat bubble –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —É–∑–ª–∞
            if (node.id === 'PLAZMA') {
                const chatBubble = document.createElement('div');
                chatBubble.className = 'chat-bubble';
                chatBubble.textContent = '1';
                nodeElement.appendChild(chatBubble);
            }
            
            structureContainer.appendChild(nodeElement);
            nodes[node.id] = nodeElement;

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–Ω–∏–π –∫—Ä—É–∂–æ–∫ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è
            if (node.children && node.children.length > 0) {
                const expandCircle = document.createElement('div');
                expandCircle.className = `expand-circle ${node.expanded ? '' : 'collapsed'}`;
                expandCircle.style.left = `${node.x + 60}px`;
                expandCircle.style.top = `${node.y + 30}px`;
                expandCircle.onclick = (e) => {
                    e.stopPropagation();
                    toggleNodeExpansion(node.id);
                };
                structureContainer.appendChild(expandCircle);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º target –∏–∫–æ–Ω–∫–∏ –¥–ª—è —Å–≤–µ—Ä–Ω—É—Ç—ã—Ö —É–∑–ª–æ–≤
            if (node.children && node.children.length > 0 && !node.expanded) {
                node.children.forEach((child, index) => {
                    const targetIcon = document.createElement('div');
                    targetIcon.className = 'target-icon';
                    targetIcon.style.left = `${node.x + 60 + index * 20}px`;
                    targetIcon.style.top = `${node.y + 40}px`;
                    targetIcon.onclick = (e) => {
                        e.stopPropagation();
                        expandNode(node.id);
                    };
                    structureContainer.appendChild(targetIcon);
                });
            }

            // Click event
            nodeElement.addEventListener('click', (e) => {
                if (node.children && node.children.length > 0) {
                    toggleNodeExpansion(node.id);
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∏–∑–æ–≥–Ω—É—Ç—ã—Ö —Å–≤—è–∑–µ–π –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ
        function renderConnection(parentId, childId) {
            const parent = nodeData[parentId];
            const child = nodeData[childId];

            if (!parent || !child) return;

            const parentEl = nodes[parentId];
            const childEl = nodes[childId];

            if (!parentEl || !childEl) return;

            const parentRect = parentEl.getBoundingClientRect();
            const childRect = childEl.getBoundingClientRect();

            const pX = parent.x + parentRect.width / 2;
            const pY = parent.y + parentRect.height;
            const cX = child.x + childRect.width / 2;
            const cY = child.y;

            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('stroke', '#3b82f6');
            path.setAttribute('stroke-width', '2');
            path.setAttribute('fill', 'none');
            path.setAttribute('class', 'connection-line');
            path.setAttribute('id', `conn-${parentId}-${childId}`);

            // –ò–∑–æ–≥–Ω—É—Ç—ã–µ –ª–∏–Ω–∏–∏ –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ
            const controlPoint1X = pX;
            const controlPoint1Y = pY + (cY - pY) * 0.3;
            const controlPoint2X = cX;
            const controlPoint2Y = cY - (cY - pY) * 0.3;

            let d = `M ${pX} ${pY} `;
            d += `C ${controlPoint1X} ${controlPoint1Y}, ${controlPoint2X} ${controlPoint2Y}, ${cX} ${cY}`;

            path.setAttribute('d', d);

            let svg = document.getElementById('connection-svg');
            if (!svg) {
                svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('id', 'connection-svg');
                svg.style.position = 'absolute';
                svg.style.top = '0';
                svg.style.left = '0';
                svg.style.width = '100%';
                svg.style.height = '100%';
                svg.style.pointerEvents = 'none';
                structureContainer.appendChild(svg);
            }
            svg.appendChild(path);
            connections[`${parentId}-${childId}`] = path;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å–≤—è–∑–µ–π
        function updateConnections() {
            const svg = document.getElementById('connection-svg');
            if (svg) {
                svg.innerHTML = '';
            }
            connections = {};

            function traverseAndConnect(node) {
                if (node.children && node.expanded) {
                    node.children.forEach(child => {
                        if (child.expanded || node.expanded) {
                            renderConnection(node.id, child.id);
                        }
                        traverseAndConnect(child);
                    });
                }
            }
            traverseAndConnect(mlmStructure);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è —É–∑–ª–∞
        function toggleNodeExpansion(nodeId) {
            const node = findNodeById(mlmStructure, nodeId);
            if (node) {
                node.expanded = !node.expanded;
                expandedNodes.add(nodeId);
                reinitializeStructure();
            }
        }

        // –†–∞—Å–∫—Ä—ã—Ç–∏–µ —É–∑–ª–∞
        function expandNode(nodeId) {
            const node = findNodeById(mlmStructure, nodeId);
            if (node) {
                node.expanded = true;
                expandedNodes.add(nodeId);
                reinitializeStructure();
            }
        }

        // –ü–æ–∏—Å–∫ —É–∑–ª–∞ –ø–æ ID
        function findNodeById(root, id) {
            if (root.id === id) return root;
            if (root.children) {
                for (let child of root.children) {
                    const found = findNodeById(child, id);
                    if (found) return found;
                }
            }
            return null;
        }

        // –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        function renderStructure(node) {
            if (node.expanded) {
                renderNode(node);
                if (node.children) {
                    node.children.forEach(child => renderStructure(child));
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        function initializeStructure() {
            structureContainer.innerHTML = '';
            const svg = document.getElementById('connection-svg');
            if (svg) svg.remove();

            nodes = {};
            connections = {};

            calculateNodePositions(mlmStructure);
            renderStructure(mlmStructure);
            updateConnections();
        }

        // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        function reinitializeStructure() {
            initializeStructure();
        }

        // –ö–Ω–æ–ø–∫–∞ Expand
        expandBtn.addEventListener('click', () => {
            // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —É–∑–ª—ã
            function expandAll(node) {
                node.expanded = true;
                if (node.children) {
                    node.children.forEach(child => expandAll(child));
                }
            }
            expandAll(mlmStructure);
            reinitializeStructure();
        });

        // –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
        initializeStructure();
    </script>
</body>
</html>
