# MLM System - Микро модульная система с админкой

Система многоуровневого маркетинга (MLM) с трехуровневой структурой рекрутинга.

## Описание системы

### Основные принципы:
- Каждый участник должен привлечь ровно 3 реферала для перехода на следующий уровень
- Первый участник, который оплатил $100, становится партнером (П1)
- Последующие участники распределяются по структуре слева направо
- Система автоматически находит место с наименьшим количеством партнеров

### Статусы пользователей:
- **Участник** (rank 0) - зарегистрирован, но не оплатил
- **Партнер** (rank 1-10) - оплатил и получил ранг

### Система бонусов:
- **Зеленый бонус** (наставнику):
  - 1-й партнер: $100
  - 2-й партнер: $50
  - 3-й партнер: $0
- **Красный бонус** (участнику):
  - 2-й партнер: $50
  - 3-й партнер: $100

## Установка и запуск

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка базы данных
```bash
python manage.py makemigrations
python manage.py migrate
```

### 3. Создание суперпользователя
```bash
python manage.py createsuperuser
```

### 4. Запуск сервера
```bash
python manage.py runserver
```

## Доступ к системе

- **Админ панель**: http://localhost:8000/admin-panel/
- **Django Admin**: http://localhost:8000/admin/
- **API**: http://localhost:8000/api/

## Структура проекта

```
mlm_system/
├── users/                 # Модуль пользователей
│   ├── models.py         # Модели User, PartnerStructure, Bonus
│   ├── services.py       # MLM логика
│   ├── admin.py          # Админка пользователей
│   └── views.py          # API для пользователей
├── admin_panel/          # Кастомная админ панель
│   ├── views.py          # Представления админки
│   ├── urls.py           # URL маршруты
│   └── templates/        # HTML шаблоны
├── payments/             # Модуль платежей
│   ├── models.py         # Модель Payment
│   ├── views.py          # API для платежей
│   └── admin.py          # Админка платежей
└── mlm_system/           # Основные настройки Django
    ├── settings.py       # Конфигурация
    └── urls.py           # Главные URL маршруты
```

## Основные функции

### Админ панель
- Просмотр всех пользователей с фильтрацией
- Статистика по системе
- Добавление пользователей вручную
- Обработка платежей
- Перемещение пользователей в структуре

### API
- Регистрация пользователей
- Обработка платежей
- Получение структуры партнеров
- Управление бонусами

### Автоматизация
- Автоматическое распределение партнеров
- Расчет и выплата бонусов
- Обновление статистики
- Повышение рангов

## Использование

### 1. Регистрация пользователя
```python
from users.services import MLMService

user = MLMService.register_user(
    username='test_user',
    email='test@example.com',
    first_name='Test',
    last_name='User',
    referral_code='ABC123'  # опционально
)
```

### 2. Обработка платежа
```python
payment = MLMService.process_payment(user, 100.00)
```

### 3. Получение статистики
```python
stats = MLMService.get_user_stats()
```

## Настройка

Все настройки находятся в `mlm_system/settings.py`:
- База данных
- Статические файлы
- Логирование
- CORS настройки

## Логирование

Логи сохраняются в `logs/django.log` и выводятся в консоль.

## Безопасность

- CSRF защита включена
- Аутентификация через Django
- Валидация всех входных данных
- Транзакционная безопасность операций

## Разработка

### Добавление новых функций
1. Создайте модель в соответствующем приложении
2. Добавьте сериализатор
3. Создайте ViewSet или APIView
4. Обновите админку
5. Добавьте тесты

### Тестирование
```bash
python manage.py test
```

## Поддержка

Для вопросов и предложений создайте issue в репозитории.
